{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/oranges/source/css/base.css","path":"css/base.css","modified":0,"renderable":1},{"_id":"themes/oranges/source/css/github-markdown.css","path":"css/github-markdown.css","modified":0,"renderable":1},{"_id":"themes/oranges/source/css/highlight.css","path":"css/highlight.css","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/demo.css","path":"iconfont/demo.css","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/demo_index.html","path":"iconfont/demo_index.html","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.css","path":"iconfont/iconfont.css","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.eot","path":"iconfont/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.js","path":"iconfont/iconfont.js","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.json","path":"iconfont/iconfont.json","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.svg","path":"iconfont/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.ttf","path":"iconfont/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.woff","path":"iconfont/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/oranges/source/iconfont/iconfont.woff2","path":"iconfont/iconfont.woff2","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/favicon.png","path":"images/favicon.png","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/icons8-espresso-cup-100 (1).png","path":"images/icons8-espresso-cup-100 (1).png","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/icons8-espresso-cup-100.png","path":"images/icons8-espresso-cup-100.png","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/icons8-matcha-tea-100.png","path":"images/icons8-matcha-tea-100.png","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/icons8-tea-cup-64.png","path":"images/icons8-tea-cup-64.png","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/mitre-logo.svg","path":"images/mitre-logo.svg","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/mitrelogosmall.gif","path":"images/mitrelogosmall.gif","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/seth-datathon-square1 not this either.jpg","path":"images/seth-datathon-square1 not this either.jpg","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/seth-datathon-square2.jpg","path":"images/seth-datathon-square2.jpg","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/seth-datathon-square3 not this.jpg","path":"images/seth-datathon-square3 not this.jpg","modified":0,"renderable":1},{"_id":"themes/oranges/source/images/sethmachine-datathon.jpg","path":"images/sethmachine-datathon.jpg","modified":0,"renderable":1},{"_id":"themes/oranges/source/js/activeNav.js","path":"js/activeNav.js","modified":0,"renderable":1},{"_id":"themes/oranges/source/js/backtotop.js","path":"js/backtotop.js","modified":0,"renderable":1},{"_id":"themes/oranges/source/js/catalog.js","path":"js/catalog.js","modified":0,"renderable":1},{"_id":"themes/oranges/source/js/fancybox.js","path":"js/fancybox.js","modified":0,"renderable":1},{"_id":"themes/oranges/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"source/misc/valheim-dedicated-server-manual.pdf","path":"misc/valheim-dedicated-server-manual.pdf","modified":0,"renderable":0}],"Cache":[{"_id":"source/.DS_Store","hash":"783c9c995ab98b5b2ee94f1a209bd653c51552f0","modified":1615143026933},{"_id":"source/_posts/.DS_Store","hash":"d2fc3c17f2fe6547c6cd697ebb27b47bac1d7584","modified":1615143026934},{"_id":"source/about/index.md","hash":"6dab933285a65e9a3ef63d8cbde52864f56b38d2","modified":1615143026944},{"_id":"source/archives/index.md","hash":"a12eb76adbc2dc7e8db2b9eef65997be34f882bc","modified":1615143026944},{"_id":"source/_posts/host-valheim-with-docker.md","hash":"f93cf1f00ff4dbb8ad8fc357738fa6398ef68cf2","modified":1615157983757},{"_id":"source/tags/index.md","hash":"1bd2e1ba306c8c2c3b720906467d9a44a1681ca1","modified":1615143026945},{"_id":"source/_posts/host-valheim-with-docker/valheim-dedicated-server-logo.jpg","hash":"56113ff452a52d9520dc957ef98536dc6e3d2786","modified":1615143026941},{"_id":"themes/oranges/.DS_Store","hash":"f09a86bb4ce7d04901ec1bb4cb55bee99909840c","modified":1615143026972},{"_id":"themes/oranges/LICENSE","hash":"f811cebccc40c019ffd2156f1f15e226e1b86f79","modified":1615143026973},{"_id":"themes/oranges/.gitignore","hash":"986003ff5239d03749d3d3b570671bbb7ffadba6","modified":1615143027001},{"_id":"themes/oranges/README-zh.md","hash":"4a3663f135b416c7dcf9337361a2752dea56372c","modified":1615143027002},{"_id":"themes/oranges/README.md","hash":"dd3bf1d8d752515ae42e3b50f601b2fa33b454ee","modified":1615143027000},{"_id":"themes/oranges/languages/de.yml","hash":"72cc121b4a9e18c55623cf8035d288e415841851","modified":1615143026997},{"_id":"themes/oranges/_config.yml","hash":"39c6e7e9c102f69fa0ec2ce39e93ebb91ff71201","modified":1615143027002},{"_id":"themes/oranges/languages/es.yml","hash":"29cf37178f7596fe408cd3234d3addb880608287","modified":1615143026996},{"_id":"themes/oranges/languages/default.yml","hash":"c8740c9a9faafd28d8ba8eb60d28e0160e5f9839","modified":1615143026995},{"_id":"themes/oranges/languages/fr.yml","hash":"ac102613f8a7f10b32b6e38d99d5511034733a0d","modified":1615143026998},{"_id":"themes/oranges/languages/ja.yml","hash":"08c64794618945b5da0edcc5065e46577fbd5ff3","modified":1615143026997},{"_id":"themes/oranges/languages/ko.yml","hash":"98f150835d5b039cdfe1cf8b32df815d8d763231","modified":1615143026996},{"_id":"themes/oranges/languages/nl.yml","hash":"e6f86d1bc16c916089057e8c8d354983ee839d21","modified":1615143027000},{"_id":"themes/oranges/languages/no.yml","hash":"1c6fd53c378fdd00c2f84ef0af4f61c1f8ea4f8b","modified":1615143026999},{"_id":"themes/oranges/languages/ru.yml","hash":"ada59b0713fef0e6617a12b20065ce9b24234521","modified":1615143026998},{"_id":"themes/oranges/languages/pt.yml","hash":"0719f13aa9f5211400b129d310f517750f4a6e0b","modified":1615143026996},{"_id":"themes/oranges/languages/zh-CN.yml","hash":"3a3b4ade3ffcf5ef330e31d3ce0d69804cfa7c26","modified":1615143026999},{"_id":"themes/oranges/languages/zh-TW.yml","hash":"3d26316a125ea18c64658d4e028351e395e45756","modified":1615143026999},{"_id":"themes/oranges/layout/category.ejs","hash":"ad8ef3de7066f2f7a4d8e603c9ee9ed3e5aa237e","modified":1615143026974},{"_id":"themes/oranges/layout/archive.ejs","hash":"aceecc0bf9b02f2b70905a7b18cbf625f407b6cb","modified":1615143026975},{"_id":"themes/oranges/layout/index.ejs","hash":"492bd5d33bf4a5d8baec1028dd54180d4caec3ef","modified":1615143026975},{"_id":"themes/oranges/layout/tag.ejs","hash":"2969bf8ba785fa9f592162e3b6fb3e7ae98eba64","modified":1615143026975},{"_id":"themes/oranges/layout/layout.ejs","hash":"c95237a0fcd33f1bbf52a079781cb86cce9e8664","modified":1615143026975},{"_id":"themes/oranges/layout/post.ejs","hash":"b57a8d2a47b30bd3e7d8bef539b223e4ff6eb59d","modified":1615143026974},{"_id":"themes/oranges/layout/_partial/backtotop.ejs","hash":"a7dfc124629cb256adf26963bb393b89f09a3476","modified":1615143026976},{"_id":"themes/oranges/layout/_partial/comments.ejs","hash":"ae42630259c2a5219b27b1a7167056789e03af14","modified":1615143026977},{"_id":"themes/oranges/layout/_partial/catalog.ejs","hash":"e2f11cd3d8b90962b9651bd4614161518577261f","modified":1615143026976},{"_id":"themes/oranges/layout/_partial/footer.ejs","hash":"c399fd6447b765311dfaa351302f9cde92e03e3e","modified":1615143026978},{"_id":"themes/oranges/source/.DS_Store","hash":"2716e5b3bbe0ae9268520a8907b337b3312df1ab","modified":1615143026979},{"_id":"themes/oranges/layout/_partial/header.ejs","hash":"40f1733d15d984dc842d4bc9b77c7302afc32f40","modified":1615143026977},{"_id":"themes/oranges/layout/_partial/navigation.ejs","hash":"b345ef52f0211b259a051940db044ba33567717d","modified":1615143026978},{"_id":"themes/oranges/layout/_partial/search.ejs","hash":"65e972df84a1fd5edceeb68383536c30fbfb59ad","modified":1615143026977},{"_id":"themes/oranges/source/css/base.css","hash":"9f19cd7de5779a0dc5b0b9a291e0e59b5ff7e82a","modified":1615143026980},{"_id":"themes/oranges/source/css/highlight.css","hash":"22c32290b22589e69f53cbbd632c77bf398f2130","modified":1615143026979},{"_id":"themes/oranges/source/css/github-markdown.css","hash":"f78aa3fbbcc5cceab0ee67246b55db8b982c4634","modified":1615143026980},{"_id":"themes/oranges/source/iconfont/demo_index.html","hash":"db375ad1f08ed3eeeb455771fca147838394551a","modified":1615143026994},{"_id":"themes/oranges/source/iconfont/iconfont.css","hash":"1f85622f536e013abf182b0f086aea95f9659cd5","modified":1615143026995},{"_id":"themes/oranges/source/iconfont/demo.css","hash":"65c50db528a5abe06426b1a20735feaf1f2a0d9b","modified":1615143026992},{"_id":"themes/oranges/source/iconfont/iconfont.eot","hash":"ec8e59b46aee56ebd3fd4bc891fa89b141f8dd77","modified":1615143026993},{"_id":"themes/oranges/source/iconfont/iconfont.json","hash":"e5b5adc779aee597e4416d5aea66456de7faf41e","modified":1615143026992},{"_id":"themes/oranges/source/iconfont/iconfont.js","hash":"55c291a13445c03d566ac8436103a72806d212a5","modified":1615143026991},{"_id":"themes/oranges/source/iconfont/iconfont.woff","hash":"97b0996a861db6fdbbc35f40319580273604404b","modified":1615143026992},{"_id":"themes/oranges/source/iconfont/iconfont.svg","hash":"39b05213c87755919dd16144be63e288c58d9e81","modified":1615143026995},{"_id":"themes/oranges/source/iconfont/iconfont.ttf","hash":"434a4874aca648921248884536c3bf3e15e8ff46","modified":1615143026993},{"_id":"themes/oranges/source/iconfont/iconfont.woff2","hash":"7ef38c1ebe016f9431f1ef5e9ee7348b38a3a3a9","modified":1615143026994},{"_id":"themes/oranges/source/images/icons8-espresso-cup-100.png","hash":"964ba3cfc8de0655b0969f849b456f034fb0acb9","modified":1615143026981},{"_id":"themes/oranges/source/images/favicon.png","hash":"21cf9c2e9c36c244a6542a3b6c220f13fa1a67cc","modified":1615143026985},{"_id":"themes/oranges/source/images/avatar.png","hash":"642ef58c0781d0f1885775ddd349ca7af65f24b0","modified":1615143026984},{"_id":"themes/oranges/source/images/icons8-espresso-cup-100 (1).png","hash":"1bc26c675a66531c4869be58c7af7771bd6f8384","modified":1615143026986},{"_id":"themes/oranges/source/images/favicon.ico","hash":"9c99d0ea8f056d759fd89f54ce4ee61c7461477e","modified":1615143026982},{"_id":"themes/oranges/source/images/mitre-logo.svg","hash":"f82bdc59193fed04ebd21fe51aa2d91c273f65b6","modified":1615143026984},{"_id":"themes/oranges/source/images/icons8-matcha-tea-100.png","hash":"327c757925dedb9773f924d8d36aa7e4a45f33f2","modified":1615143026986},{"_id":"themes/oranges/source/images/mitrelogosmall.gif","hash":"04f2627aaa09429ca5b605358724b909e617c02a","modified":1615143026989},{"_id":"themes/oranges/source/images/icons8-tea-cup-64.png","hash":"58477be72091c6bd2fc35920466361ca2d7eb54f","modified":1615143026984},{"_id":"themes/oranges/source/js/backtotop.js","hash":"7d31a9b613dcaa88e0f4154a62cd0fb2cfe598e8","modified":1615143026991},{"_id":"themes/oranges/source/js/catalog.js","hash":"5617cd7a8bca47debb29ca45e1ec33c84e6603f7","modified":1615143026990},{"_id":"themes/oranges/source/js/activeNav.js","hash":"06aa9a2985f1d328f0b7fe69a28bee31f16ebb1a","modified":1615143026990},{"_id":"themes/oranges/source/js/search.js","hash":"374efc788268330edd7ca0c91a43e75f7ec4149c","modified":1615143026991},{"_id":"themes/oranges/source/js/fancybox.js","hash":"5b89b606bb76dd18b9a9713e5e9d81ae6932e95c","modified":1615143026990},{"_id":"source/misc/valheim-dedicated-server-manual.pdf","hash":"1b4e0fe194849385412b4c915aa665cacf2b70f4","modified":1615143026933},{"_id":"source/_posts/host-valheim-with-docker/show-forwarded-ports-2456-2457-2458.png","hash":"1e57c394415f24cb102e1875bdb6d977aad38db3","modified":1615143026943},{"_id":"source/_posts/host-valheim-with-docker/change-docker-memory-cpus.png","hash":"1f78ec3929dbba123316e53c5fd605223fa01ea9","modified":1615143026939},{"_id":"source/_posts/host-valheim-with-docker/docker-restart-on-log-in.png","hash":"18b8f3f100946d5df66e7dc0f6980bc49c1d6569","modified":1615143026940},{"_id":"themes/oranges/source/images/seth-datathon-square2.jpg","hash":"18e5dd368127afc3340df7d82e32f71f8310db88","modified":1615143026988},{"_id":"themes/oranges/source/images/seth-datathon-square3 not this.jpg","hash":"2e7bb62f3bc211f40e2eec4ef3a56673118dc5f3","modified":1615143026983},{"_id":"source/_posts/host-valheim-with-docker/router-port-forwarding-location.png","hash":"5d9018ce7da768deb476ac1408441c50e5f284d3","modified":1615143026936},{"_id":"themes/oranges/source/images/seth-datathon-square1 not this either.jpg","hash":"b948d57dbbe091d2fb636e23e5762694b8bf1333","modified":1615143026982},{"_id":"themes/oranges/source/images/sethmachine-datathon.jpg","hash":"e383c4765fb5062fc046ddd7b264bc196d9ba648","modified":1615143026987},{"_id":"source/_posts/host-valheim-with-docker/show-check-host-ports-open.png","hash":"cfea5488c697b43701f86f5506a6fa5dc57dd8cf","modified":1615143026941},{"_id":"source/_posts/host-valheim-with-docker/steam-add-server.png","hash":"cc0ab1f0e61ff1aafe2204a225fb59bb8205d5dc","modified":1615143026942},{"_id":"source/_posts/host-valheim-with-docker/steam-server-listed.png","hash":"118dc76aaaa643a0fbece6525868ac884a501435","modified":1615143026938},{"_id":"source/_posts/host-valheim-with-docker/valeheim-see-server.png","hash":"256546f9eca2a24e80cadeb6b7e1e80a8c7659ab","modified":1615143026939},{"_id":"source/_posts/host-valheim-with-docker/steam-view-servers-menu.png","hash":"7a582658ee5f71c09047b53a62bd131a96e57b45","modified":1615143026937},{"_id":"public/about/index.html","hash":"dae9877c2ee5d7a00d2150bbb9bfd2c1453234b9","modified":1615158609170},{"_id":"public/archives/index.html","hash":"e6419f607199be8e781435a51d343e9c9c19b813","modified":1615158609170},{"_id":"public/tags/index.html","hash":"d28828f77e2ac54ae547a3d89731df6bf90481f8","modified":1615158609170},{"_id":"public/index.html","hash":"cd1137ffbf5b95c222c6a3bcd56b4c8c7d7e31d1","modified":1615158609170},{"_id":"public/tags/Docker/index.html","hash":"93f66192023b1789b9beae7a4ba01b50e51fdbdd","modified":1615158609170},{"_id":"public/tags/Valheim/index.html","hash":"7f9ed98654389e841ca61e18c7927d1d0ffca9db","modified":1615158609170},{"_id":"public/tags/Steam/index.html","hash":"d19fa9aa6ce4ae5096b6641c0ff91ae4776c5078","modified":1615158609170},{"_id":"public/tags/Port-Forwarding/index.html","hash":"887cac5538616bff26f5e60390d4e63d250b9dd5","modified":1615158609170},{"_id":"public/tags/Dedicated-Server/index.html","hash":"b5c21c8d1a82ae43e4b356c72c0be56cb67e5e99","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/index.html","hash":"4a364d95f536485d50a024974fa321f7e5e4a4ab","modified":1615158609170},{"_id":"public/iconfont/iconfont.eot","hash":"ec8e59b46aee56ebd3fd4bc891fa89b141f8dd77","modified":1615158609170},{"_id":"public/iconfont/iconfont.ttf","hash":"434a4874aca648921248884536c3bf3e15e8ff46","modified":1615158609170},{"_id":"public/iconfont/iconfont.svg","hash":"39b05213c87755919dd16144be63e288c58d9e81","modified":1615158609170},{"_id":"public/iconfont/iconfont.woff","hash":"97b0996a861db6fdbbc35f40319580273604404b","modified":1615158609170},{"_id":"public/iconfont/iconfont.woff2","hash":"7ef38c1ebe016f9431f1ef5e9ee7348b38a3a3a9","modified":1615158609170},{"_id":"public/images/favicon.png","hash":"21cf9c2e9c36c244a6542a3b6c220f13fa1a67cc","modified":1615158609170},{"_id":"public/images/favicon.ico","hash":"9c99d0ea8f056d759fd89f54ce4ee61c7461477e","modified":1615158609170},{"_id":"public/images/avatar.png","hash":"642ef58c0781d0f1885775ddd349ca7af65f24b0","modified":1615158609170},{"_id":"public/images/icons8-espresso-cup-100 (1).png","hash":"1bc26c675a66531c4869be58c7af7771bd6f8384","modified":1615158609170},{"_id":"public/images/icons8-espresso-cup-100.png","hash":"964ba3cfc8de0655b0969f849b456f034fb0acb9","modified":1615158609170},{"_id":"public/images/icons8-matcha-tea-100.png","hash":"327c757925dedb9773f924d8d36aa7e4a45f33f2","modified":1615158609170},{"_id":"public/images/mitre-logo.svg","hash":"f82bdc59193fed04ebd21fe51aa2d91c273f65b6","modified":1615158609170},{"_id":"public/images/icons8-tea-cup-64.png","hash":"58477be72091c6bd2fc35920466361ca2d7eb54f","modified":1615158609170},{"_id":"public/images/mitrelogosmall.gif","hash":"04f2627aaa09429ca5b605358724b909e617c02a","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/valheim-dedicated-server-logo.jpg","hash":"56113ff452a52d9520dc957ef98536dc6e3d2786","modified":1615158609170},{"_id":"public/misc/valheim-dedicated-server-manual.pdf","hash":"1b4e0fe194849385412b4c915aa665cacf2b70f4","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/show-forwarded-ports-2456-2457-2458.png","hash":"1e57c394415f24cb102e1875bdb6d977aad38db3","modified":1615158609170},{"_id":"public/css/base.css","hash":"9f19cd7de5779a0dc5b0b9a291e0e59b5ff7e82a","modified":1615158609170},{"_id":"public/css/highlight.css","hash":"22c32290b22589e69f53cbbd632c77bf398f2130","modified":1615158609170},{"_id":"public/css/github-markdown.css","hash":"f78aa3fbbcc5cceab0ee67246b55db8b982c4634","modified":1615158609170},{"_id":"public/iconfont/demo.css","hash":"65c50db528a5abe06426b1a20735feaf1f2a0d9b","modified":1615158609170},{"_id":"public/iconfont/iconfont.css","hash":"1f85622f536e013abf182b0f086aea95f9659cd5","modified":1615158609170},{"_id":"public/iconfont/iconfont.json","hash":"b0951799125e3a304e8993fb687679844ff7043a","modified":1615158609170},{"_id":"public/js/activeNav.js","hash":"06aa9a2985f1d328f0b7fe69a28bee31f16ebb1a","modified":1615158609170},{"_id":"public/js/backtotop.js","hash":"7d31a9b613dcaa88e0f4154a62cd0fb2cfe598e8","modified":1615158609170},{"_id":"public/js/catalog.js","hash":"5617cd7a8bca47debb29ca45e1ec33c84e6603f7","modified":1615158609170},{"_id":"public/js/fancybox.js","hash":"5b89b606bb76dd18b9a9713e5e9d81ae6932e95c","modified":1615158609170},{"_id":"public/js/search.js","hash":"374efc788268330edd7ca0c91a43e75f7ec4149c","modified":1615158609170},{"_id":"public/iconfont/demo_index.html","hash":"db375ad1f08ed3eeeb455771fca147838394551a","modified":1615158609170},{"_id":"public/iconfont/iconfont.js","hash":"55c291a13445c03d566ac8436103a72806d212a5","modified":1615158609170},{"_id":"public/images/seth-datathon-square2.jpg","hash":"18e5dd368127afc3340df7d82e32f71f8310db88","modified":1615158609170},{"_id":"public/images/seth-datathon-square3 not this.jpg","hash":"2e7bb62f3bc211f40e2eec4ef3a56673118dc5f3","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/change-docker-memory-cpus.png","hash":"1f78ec3929dbba123316e53c5fd605223fa01ea9","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/docker-restart-on-log-in.png","hash":"18b8f3f100946d5df66e7dc0f6980bc49c1d6569","modified":1615158609170},{"_id":"public/images/seth-datathon-square1 not this either.jpg","hash":"b948d57dbbe091d2fb636e23e5762694b8bf1333","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/router-port-forwarding-location.png","hash":"5d9018ce7da768deb476ac1408441c50e5f284d3","modified":1615158609170},{"_id":"public/images/sethmachine-datathon.jpg","hash":"e383c4765fb5062fc046ddd7b264bc196d9ba648","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/show-check-host-ports-open.png","hash":"cfea5488c697b43701f86f5506a6fa5dc57dd8cf","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/steam-server-listed.png","hash":"118dc76aaaa643a0fbece6525868ac884a501435","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/steam-add-server.png","hash":"cc0ab1f0e61ff1aafe2204a225fb59bb8205d5dc","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/valeheim-see-server.png","hash":"256546f9eca2a24e80cadeb6b7e1e80a8c7659ab","modified":1615158609170},{"_id":"public/2021/02/10/host-valheim-with-docker/steam-view-servers-menu.png","hash":"7a582658ee5f71c09047b53a62bd131a96e57b45","modified":1615158609170}],"Category":[],"Data":[],"Page":[{"title":"About","date":"2021-01-01T05:00:00.000Z","_content":"\n## About\n\nHi, I'm Seth and welcome!  I wrote this blog as a way to (1) share, document, and compress knowledge about my various projects, and (2) communicate with the greater tech community (recruiters, engineers, data scientists, etc.).  \n\nMy interests are in applied machine learning, natural language processing, computational linguistics, and software engineering.    \n\nPython is my preferred language; though I've also been using Java at my recent employers (HubSpot, Amazon).  I firmly believe in [Occam's razor](https://en.wikipedia.org/wiki/Occam%27s_razor) when it comes to problem solving in both machine learning and software engineering.  \n\nThings I like outside of tech include:\n\n* Tea, always brewed with loose leaf\n* Board games: including but not limited to [Clank!](https://boardgamegeek.com/boardgame/201808/clank-deck-building-adventure), [Archipelago](https://boardgamegeek.com/boardgame/105551/archipelago), etc.\n* Video games: [Starcraft](https://en.wikipedia.org/wiki/StarCraft), [Warcraft III](https://en.wikipedia.org/wiki/Warcraft_III:_Reign_of_Chaos), [Risk of Rain 2](https://en.wikipedia.org/wiki/Risk_of_Rain_2), etc.\n* Hiking, rock climbing (indoor and outdoor)\n* Linguistics/foreign languages; I can read written French and Spanish\n* Starcraft/Warcraft modding; someone once wrote a whole strategy guide about a Starcraft game I made!: [War of the Lost Kingdoms Strategy guide](https://www.campaigncreations.org/forum/viewtopic.php?t=2052#p32008)\n\n## Papers\n\n[SemEval 2015 Task 8](https://www.researchgate.net/publication/301446274_SemEval-2015_Task_8_SpaceEval): joint work with Brandeis; I trained a conditional random field to identify spatial entities notably using features from a rich semantic parser.  \n\n## Personal Projects\n\n* [chkjson](https://github.com/sethmachine/chkjson): a Python library to read Starcraft's binary CHK format for the purposes of making modding easier.  It was a good exercise in reading and writing binary data.  It's also a good example of how not to use dataclasses in Python.  \n* [pyw3x](https://github.com/sethmachine/pyw3x): a Python wrapper around existing libraries to open and modify MPQ archives (the format used by Blizzard for both Starcraft and Warcraft III maps).  \n* [mmrpg](https://github.com/sethmachine/mmrpg): an attempt to recreate [Dragon Warrior Monsters](https://en.wikipedia.org/wiki/Dragon_Warrior_Monsters) as a custom map in Warcraft III.  It was fun creating the quest, dialogue, monster spawning, and boss systems from scratch using Blizzard's [JASS](http://jass.sourceforge.net/doc/) scripting language.  \n\n## Contact\n\n* Email: sdworman at brandeis.edu\n* Resume: Please reach out to me via email to request a resume.\n","source":"about/index.md","raw":"---\ntitle: About\ndate: 2021-01-01\n---\n\n## About\n\nHi, I'm Seth and welcome!  I wrote this blog as a way to (1) share, document, and compress knowledge about my various projects, and (2) communicate with the greater tech community (recruiters, engineers, data scientists, etc.).  \n\nMy interests are in applied machine learning, natural language processing, computational linguistics, and software engineering.    \n\nPython is my preferred language; though I've also been using Java at my recent employers (HubSpot, Amazon).  I firmly believe in [Occam's razor](https://en.wikipedia.org/wiki/Occam%27s_razor) when it comes to problem solving in both machine learning and software engineering.  \n\nThings I like outside of tech include:\n\n* Tea, always brewed with loose leaf\n* Board games: including but not limited to [Clank!](https://boardgamegeek.com/boardgame/201808/clank-deck-building-adventure), [Archipelago](https://boardgamegeek.com/boardgame/105551/archipelago), etc.\n* Video games: [Starcraft](https://en.wikipedia.org/wiki/StarCraft), [Warcraft III](https://en.wikipedia.org/wiki/Warcraft_III:_Reign_of_Chaos), [Risk of Rain 2](https://en.wikipedia.org/wiki/Risk_of_Rain_2), etc.\n* Hiking, rock climbing (indoor and outdoor)\n* Linguistics/foreign languages; I can read written French and Spanish\n* Starcraft/Warcraft modding; someone once wrote a whole strategy guide about a Starcraft game I made!: [War of the Lost Kingdoms Strategy guide](https://www.campaigncreations.org/forum/viewtopic.php?t=2052#p32008)\n\n## Papers\n\n[SemEval 2015 Task 8](https://www.researchgate.net/publication/301446274_SemEval-2015_Task_8_SpaceEval): joint work with Brandeis; I trained a conditional random field to identify spatial entities notably using features from a rich semantic parser.  \n\n## Personal Projects\n\n* [chkjson](https://github.com/sethmachine/chkjson): a Python library to read Starcraft's binary CHK format for the purposes of making modding easier.  It was a good exercise in reading and writing binary data.  It's also a good example of how not to use dataclasses in Python.  \n* [pyw3x](https://github.com/sethmachine/pyw3x): a Python wrapper around existing libraries to open and modify MPQ archives (the format used by Blizzard for both Starcraft and Warcraft III maps).  \n* [mmrpg](https://github.com/sethmachine/mmrpg): an attempt to recreate [Dragon Warrior Monsters](https://en.wikipedia.org/wiki/Dragon_Warrior_Monsters) as a custom map in Warcraft III.  It was fun creating the quest, dialogue, monster spawning, and boss systems from scratch using Blizzard's [JASS](http://jass.sourceforge.net/doc/) scripting language.  \n\n## Contact\n\n* Email: sdworman at brandeis.edu\n* Resume: Please reach out to me via email to request a resume.\n","updated":"2021-03-07T18:50:26.944Z","path":"about/index.html","comments":1,"layout":"page","_id":"cklzrqf4m0000dunh3tj568p4","content":"<h2 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h2><p>Hi, I’m Seth and welcome!  I wrote this blog as a way to (1) share, document, and compress knowledge about my various projects, and (2) communicate with the greater tech community (recruiters, engineers, data scientists, etc.).  </p>\n<p>My interests are in applied machine learning, natural language processing, computational linguistics, and software engineering.    </p>\n<p>Python is my preferred language; though I’ve also been using Java at my recent employers (HubSpot, Amazon).  I firmly believe in <a href=\"https://en.wikipedia.org/wiki/Occam%27s_razor\">Occam’s razor</a> when it comes to problem solving in both machine learning and software engineering.  </p>\n<p>Things I like outside of tech include:</p>\n<ul>\n<li>Tea, always brewed with loose leaf</li>\n<li>Board games: including but not limited to <a href=\"https://boardgamegeek.com/boardgame/201808/clank-deck-building-adventure\">Clank!</a>, <a href=\"https://boardgamegeek.com/boardgame/105551/archipelago\">Archipelago</a>, etc.</li>\n<li>Video games: <a href=\"https://en.wikipedia.org/wiki/StarCraft\">Starcraft</a>, <a href=\"https://en.wikipedia.org/wiki/Warcraft_III:_Reign_of_Chaos\">Warcraft III</a>, <a href=\"https://en.wikipedia.org/wiki/Risk_of_Rain_2\">Risk of Rain 2</a>, etc.</li>\n<li>Hiking, rock climbing (indoor and outdoor)</li>\n<li>Linguistics/foreign languages; I can read written French and Spanish</li>\n<li>Starcraft/Warcraft modding; someone once wrote a whole strategy guide about a Starcraft game I made!: <a href=\"https://www.campaigncreations.org/forum/viewtopic.php?t=2052#p32008\">War of the Lost Kingdoms Strategy guide</a></li>\n</ul>\n<h2 id=\"Papers\"><a href=\"#Papers\" class=\"headerlink\" title=\"Papers\"></a>Papers</h2><p><a href=\"https://www.researchgate.net/publication/301446274_SemEval-2015_Task_8_SpaceEval\">SemEval 2015 Task 8</a>: joint work with Brandeis; I trained a conditional random field to identify spatial entities notably using features from a rich semantic parser.  </p>\n<h2 id=\"Personal-Projects\"><a href=\"#Personal-Projects\" class=\"headerlink\" title=\"Personal Projects\"></a>Personal Projects</h2><ul>\n<li><a href=\"https://github.com/sethmachine/chkjson\">chkjson</a>: a Python library to read Starcraft’s binary CHK format for the purposes of making modding easier.  It was a good exercise in reading and writing binary data.  It’s also a good example of how not to use dataclasses in Python.  </li>\n<li><a href=\"https://github.com/sethmachine/pyw3x\">pyw3x</a>: a Python wrapper around existing libraries to open and modify MPQ archives (the format used by Blizzard for both Starcraft and Warcraft III maps).  </li>\n<li><a href=\"https://github.com/sethmachine/mmrpg\">mmrpg</a>: an attempt to recreate <a href=\"https://en.wikipedia.org/wiki/Dragon_Warrior_Monsters\">Dragon Warrior Monsters</a> as a custom map in Warcraft III.  It was fun creating the quest, dialogue, monster spawning, and boss systems from scratch using Blizzard’s <a href=\"http://jass.sourceforge.net/doc/\">JASS</a> scripting language.  </li>\n</ul>\n<h2 id=\"Contact\"><a href=\"#Contact\" class=\"headerlink\" title=\"Contact\"></a>Contact</h2><ul>\n<li>Email: sdworman at brandeis.edu</li>\n<li>Resume: Please reach out to me via email to request a resume.</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h2><p>Hi, I’m Seth and welcome!  I wrote this blog as a way to (1) share, document, and compress knowledge about my various projects, and (2) communicate with the greater tech community (recruiters, engineers, data scientists, etc.).  </p>\n<p>My interests are in applied machine learning, natural language processing, computational linguistics, and software engineering.    </p>\n<p>Python is my preferred language; though I’ve also been using Java at my recent employers (HubSpot, Amazon).  I firmly believe in <a href=\"https://en.wikipedia.org/wiki/Occam%27s_razor\">Occam’s razor</a> when it comes to problem solving in both machine learning and software engineering.  </p>\n<p>Things I like outside of tech include:</p>\n<ul>\n<li>Tea, always brewed with loose leaf</li>\n<li>Board games: including but not limited to <a href=\"https://boardgamegeek.com/boardgame/201808/clank-deck-building-adventure\">Clank!</a>, <a href=\"https://boardgamegeek.com/boardgame/105551/archipelago\">Archipelago</a>, etc.</li>\n<li>Video games: <a href=\"https://en.wikipedia.org/wiki/StarCraft\">Starcraft</a>, <a href=\"https://en.wikipedia.org/wiki/Warcraft_III:_Reign_of_Chaos\">Warcraft III</a>, <a href=\"https://en.wikipedia.org/wiki/Risk_of_Rain_2\">Risk of Rain 2</a>, etc.</li>\n<li>Hiking, rock climbing (indoor and outdoor)</li>\n<li>Linguistics/foreign languages; I can read written French and Spanish</li>\n<li>Starcraft/Warcraft modding; someone once wrote a whole strategy guide about a Starcraft game I made!: <a href=\"https://www.campaigncreations.org/forum/viewtopic.php?t=2052#p32008\">War of the Lost Kingdoms Strategy guide</a></li>\n</ul>\n<h2 id=\"Papers\"><a href=\"#Papers\" class=\"headerlink\" title=\"Papers\"></a>Papers</h2><p><a href=\"https://www.researchgate.net/publication/301446274_SemEval-2015_Task_8_SpaceEval\">SemEval 2015 Task 8</a>: joint work with Brandeis; I trained a conditional random field to identify spatial entities notably using features from a rich semantic parser.  </p>\n<h2 id=\"Personal-Projects\"><a href=\"#Personal-Projects\" class=\"headerlink\" title=\"Personal Projects\"></a>Personal Projects</h2><ul>\n<li><a href=\"https://github.com/sethmachine/chkjson\">chkjson</a>: a Python library to read Starcraft’s binary CHK format for the purposes of making modding easier.  It was a good exercise in reading and writing binary data.  It’s also a good example of how not to use dataclasses in Python.  </li>\n<li><a href=\"https://github.com/sethmachine/pyw3x\">pyw3x</a>: a Python wrapper around existing libraries to open and modify MPQ archives (the format used by Blizzard for both Starcraft and Warcraft III maps).  </li>\n<li><a href=\"https://github.com/sethmachine/mmrpg\">mmrpg</a>: an attempt to recreate <a href=\"https://en.wikipedia.org/wiki/Dragon_Warrior_Monsters\">Dragon Warrior Monsters</a> as a custom map in Warcraft III.  It was fun creating the quest, dialogue, monster spawning, and boss systems from scratch using Blizzard’s <a href=\"http://jass.sourceforge.net/doc/\">JASS</a> scripting language.  </li>\n</ul>\n<h2 id=\"Contact\"><a href=\"#Contact\" class=\"headerlink\" title=\"Contact\"></a>Contact</h2><ul>\n<li>Email: sdworman at brandeis.edu</li>\n<li>Resume: Please reach out to me via email to request a resume.</li>\n</ul>\n"},{"title":"archives","date":"2020-12-26T02:47:55.000Z","type":"archives","_content":"","source":"archives/index.md","raw":"---\ntitle: archives\ndate: 2020-12-25 21:47:55\ntype: archives\n---\n","updated":"2021-03-07T18:50:26.944Z","path":"archives/index.html","comments":1,"layout":"page","_id":"cklzrqf4o0001dunh8zg63wdm","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2020-12-26T02:42:34.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2020-12-25 21:42:34\ntype: tags\n---\n","updated":"2021-03-07T18:50:26.945Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cklzrqf4o0002dunh2x6faqcm","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Host Valheim with Docker","date":"2021-02-11T02:14:51.000Z","_content":"## Introduction\n\n![Valheim Dedicated Server with Docker](valheim-dedicated-server-logo.jpg)\n\nThis guide explains how to host a dedicated Valheim server with Docker that can be run at home while still being publicly accessible over the internet so your friends can join anytime.  Ideally the server is hosted on a spare computer, but it can still run on the same computer you play on.   \n\nFor those unfamiliar, [Valheim](https://store.steampowered.com/app/892970/Valheim/) is a builder-survival that is akin to Minecraft but much darker and focused on a Viking theme, which has gone viral with over 1 million purchases in its first weeks. Now is a better time than ever to start playing!\n\nIf you've worked with Docker before and know what you're doing, feel free to jump straight to using the image I built:\n\n* Docker Hub: [sethmachineio/valheim-server](https://hub.docker.com/r/sethmachineio/valheim-server)\n* GitHub: [valheim-server-docker](https://github.com/sethmachine/valheim-server-docker)\n\n## Why host your own?\n\nValheim does have \"peer-to-peer\" hosting. But if the host logs off, then the world is no longer accessible to anyone and everyone else gets removed from the world. Hosting a dedicated Valheim server solves this by being accessible 24/7, so your friends can play even if you're not online. This makes the experience all the more immersive.  \n\nHosting at home also means a lot of cost savings. It's already possible to rent a dedicated Valheim server for around [$12/month](https://www.g-portal.com/us/en/gameserver/valheim-server-hosting?gclid=CjwKCAiA65iBBhB-EiwAW253Wwfyd6STzTQV4yvvwD_GBJHvuZDQkZNDuSTUMHexNYkIT_Z0zVPSDhoCzUkQAvD_BwE). However, I estimate my 2013 iMac would only cost around $7/month to run 24/7 (assuming the monitor is completely turned off). See: [iMac energy consumption](https://support.apple.com/en-us/HT201918) and [Electricity usage of a Computer calculator](https://energyusecalculator.com/electricity_computer.htm#:~:text=We%20estimate%20that%20an%20average,not%20including%20the%20display%20screen.).  I used 100 watts as an estimate. That is a cost savings of over 40%!\n\nIn summary:\n\n* You want a dedicated server running 24/7.\n* You want to save over 40% compared to renting a dedicated server (or buying compute from AWS/Google Cloud, etc.).\n* You want to have fun on a mini project and learn about Docker/hosting.\n\n## About Docker\n[Docker](https://www.docker.com/why-docker) allows for a repeatable and configurable process to manage running the Valheim server. Meaning if we ever need to update the server, we simply rebuild it in a single command with Docker. As a Docker container, the server can be run on any computer that also runs Docker. This means it's easy to move the server to another computer if needed (e.g. more resources such as memory). Further, we can take advantage of Docker's automatic restart policies, so the server will automatically turn back on if the host machine restarts.\n\nIf you want to host on macOS, Docker is absolute requirement, as Valheim is only supported on Windows and Linux.  Using the steps in this guide I have been able to host my Valheim server on my 2013 iMac.  Note that playing the actual game must be done on Windows or Linux.     \n \n## Prerequisites\n\n* You have access to the PC to run the server.\n* You are comfortable using the terminal/command prompt.  \n* You have admin access to your router/ISP so you can change firewall and port forwarding rules.\n* The host machine is able to run Docker.  \n* The host machine is able to run 24/7.  \n\n## Setup Docker\n\nDownload and install [Docker Desktop](https://www.docker.com/products/docker-desktop) on the host machine. I installed it on macOS but same steps apply if you are using Windows or Linux. You may get prompted for a tutorial when starting Docker Desktop for the first time, feel free to complete it if you aren't familiar with Docker.  \n\nOnce installed, head to Docker's preferences to change resources and restart policy. Make sure to check the checkbox \"Start Docker Desktop when you log in\".    \n\n![](docker-restart-on-log-in.png)\n\nChange the amount of memory, CPUs, and disk space Docker is allocated.  Any running Docker containers won't exceed the amounts here. If the host machine is just running the Valheim server, I'd recommend to allocate all available memory and CPUs to maximize performance. The disk image size constraints how much storage Docker can use before it \"runs out\"; I set mine to around 50 GB.  After making changes, hit \"Apply and Restart\" for it to take effect.   \n  \n![](change-docker-memory-cpus.png)\n\nFor next steps, we will be using Docker's command line interface (CLI) called `docker`. The CLI is only available if Docker Desktop is running. To make sure it's working, open a Terminal or Command Prompt and type in `docker ps`. You should see output similar to below.  \n\n```bash\nsethmachine % docker ps\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n``` \n\n## Run Valheim on Docker\n\nNow we need to download the Valheim server and somehow run it on Docker. Steam provides [SteamCMD](https://developer.valvesoftware.com/wiki/SteamCMD) which is a command-line interface of the Steam client. It can be used to programmatically download Steam games and servers. We will use it to download the Valheim server. Thankfully there is already an existing Docker image that comes with SteamCMD ready to use: [cm2network/steamcmd](https://hub.docker.com/r/cm2network/steamcmd).  \n\nDownload the Docker image:\n\n```bash\nsethmachine % docker pull cm2network/steamcmd\nUsing default tag: latest\nlatest: Pulling from cm2network/steamcmd\n45b42c59be33: Pull complete \na4d9e5a1b4b0: Pull complete \nDigest: sha256:0bd046d574a92bdd7a020beb9a8bc4ab8498d96422c005893316800d630a58c3\nStatus: Downloaded newer image for cm2network/steamcmd:latest\ndocker.io/cm2network/steamcmd:latest\n``` \n\nNext let's run the image in interactive mode to make sure it works and see how we could run a Valheim server.  \n\n```bash\nsethmachine % docker run -it --name=steamcmd cm2network/steamcmd\nsteam@cf87295af3ac:~/steamcmd$ \n``` \n\nYou should notice your command prompt has changed.  We are now in the running Docker container in interactive mode. Some things to note:\n \n * The Docker container will stop running if you exit (e.g. CTRL+D)\n * While the container is running, use `docker ps` to find its container ID (host machine terminal)\n * The running container is named `steamcmd` (from `--name=steamcmd`).  \n * The same container can be re-activated by using `docker start --interactive steamcmd`\n * To delete the named container, use `docker rm steamcmd`.  \n\nWith SteamCMD, we can now install the Valheim server. We need its ID which happens to be `896660`. I found this information on steamdb.com: [Valheim Server](https://steamdb.info/app/896660/).  \n\nRun the following command to install the Valheim server in the running Docker container:\n\n```bash\n./steamcmd.sh +login anonymous \\\n+force_install_dir valheimserver/ \\\n+app_update 896660 \\\nvalidate +exit \n```\n\nAfter a minute you should see a message like \"Success! App '896660' fully installed.\"\n\nIn the current directory, there is now a `valheimserver/` folder:\n\n```shell\nsteam@cf87295af3ac:~/steamcmd$ ls valheimserver/\n LinuxPlayer_s.debug   UnityPlayer_s.debug                    linux64           start_server.sh         steam_appid.txt   steamclient.so          valheim_server_Data\n UnityPlayer.so       'Valheim Dedicated Server Manual.pdf'   server_exit.drp   start_server_xterm.sh   steamapps         valheim_server.x86_64\n```\n\nThe server install includes a manual which I've also made available here: [Valheim Dedicated Server Manual](/misc/valheim-dedicated-server-manual.pdf) (disclaimer: the manual is subject to change so this link may become outdated). The manual explains how to run the Valheim server and its different configurable options.  Below is the command I used to copy the manual from the running Docker container. This command is run from the host machine's terminal and not within the Docker container.  \n\n```bash\ndocker cp steamcmd:/home/steam/steamcmd/valheimserver/'Valheim Dedicated Server Manual.pdf' ~/desktop\n```\n\nAccording to the manual, we should make a copy of `start_server.sh` and supply it with our parameters. The line to edit:\n\n```shell\n./valheim_server.x86_64 -name \"My server\" -port 2456 -world \"Dedicated\" -password \"secret\"\n```\n\nThe parameters (also explained in the manual):\n\n* `-name`: the name of the server that will appear in the server list\n* `-port`: the port the server will run on.  Keep the default as `2456`.  \n* `-world`: the name of the World that will be created, or the existing World to use.  \n* `-password`: the password to enter the server.  Must be at least 5 characters.  \n* `-savedir`: where the server loads and saves the World data (not in the example as it is optional)\n\nTo create and edit a copy of `start_server.sh`:\n\n* Copy with `cp start_server.sh example-start-server.sh` then edit with `nano` (while in the Docker container). \n* Or, copy the file to the host machine, edit it there, and then copy it back to Docker\n    * Copy file to host machine to desktop: `docker cp steamcmd:/home/steam/steamcmd/valheimserver/start_server.sh ~/desktop`\n    * Edit and save as `example-start-server.sh`.  \n    * Copy back to the Docker container: `docker cp example-start-server.sh steamcmd:/home/steam/steamcmd/valheimserver`\n\nAfter editing this is what my `example-start-server.sh` looks like (I removed the comments):\n\n```bash\nexport templdpath=$LD_LIBRARY_PATH\nexport LD_LIBRARY_PATH=./linux64:$LD_LIBRARY_PATH\nexport SteamAppId=892970\n\necho \"Starting server PRESS CTRL-C to exit\"\n\n./valheim_server.x86_64 -name \"Example Server\" -port 2456 -world \"HelloWorld\" -password \"password123\"\n\nexport LD_LIBRARY_PATH=$templdpath\n```\n\nNow run it by entering `./example-start-server.sh` in the Docker container. It should spit out a lot of different debug output. Of interest is it prints the world seed generated (since we did not use the `-savedir` parameter to an existing world).  \n\n```bash\n02/13/2021 03:09:44: Initializing world generator seed:85nRPRACxA ( -1305926156 )   menu:False  worldgen version:1\n```\n\nWe can also see where the generated world is stored by default (according to the manual):\n\n```bash\nsteam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/\nadminlist.txt  bannedlist.txt  permittedlist.txt  prefs  worlds\nsteam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/worlds\nHelloWorld.db  HelloWorld.fwl\n```\n\nPress CTRL+C to stop the server from running.   \n\nCongrats!  If you've got this far, it means you can now run a Valheim server on Docker!  There are a few more steps to consolidate what we've learned and then we have to open ports before your dedicated at home server is ready.\n\n## Create a Docker image\n\nWe did a bit of work in the previous steps and it'd be nice to avoid having to repeat it. Luckily, Docker provides [Dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/), which can be used to build new Docker images from existing Docker images. Our goal here is to make a new Docker image that automatically starts the Valheim server without having to enter the container and manually enter commands as we did before. The Valheim server also needs to be shutdown gracefully so that current world data is properly saved whenever the container is stopped or restarted.  \n\nThe Valheim server Docker image should be as generic as possible while allowing a user to customize server specific behavior at runtime (e.g. which world to use, what the password is, etc.). The strategy to do this is to separate the environment and installation setup from the actual command to start the server. This means we will write a custom script to start the Valheim server that controls how the server is started and shutdown. The Valheim server also needs to persist the worlds data into the host machine (as the containers are meant to be ephemeral). Persistence is accomplished by [binding a directory from the host machine to a Docker volume](https://docs.docker.com/storage/bind-mounts/) (this is also how we can add existing worlds to the server).  \n\nGiven all that, here is our Dockerfile to build the Valheim server image:\n\n```dockerfile\nFROM cm2network/steamcmd\n\n# where the Valheim server is installed to\nENV VALHEIM_SERVER_DIR \"/home/steam/valheim-server\"\n\n# install the Valheim server\nRUN ./steamcmd.sh +login anonymous \\\n+force_install_dir $VALHEIM_SERVER_DIR \\\n+app_update 896660 \\\nvalidate +exit\n\n# where world data is stored, map this to the host directory where your worlds are stored\n# e.g. docker run -v /path/to/host/directory:/home/steam/valheim-data\nENV VALHEIM_DATA_DIR \"/home/steam/valheim-data\"\n# don't change the port unless you know what you are doing\nENV VALHEIM_PORT 2456\n# server and world name are truncated after 1st white space\n# you must set values to the server and world name otherwise the container will exit immediately\nENV VALHEIM_SERVER_NAME=\"\"\nENV VALHEIM_WORLD_NAME=\"\"\nENV VALHEIM_PASSWORD \"password\"\n\n# the server needs these 3 ports exposed by default\nEXPOSE 2456/udp\nEXPOSE 2457/udp\nEXPOSE 2458/udp\n\nVOLUME ${VALHEIM_DATA_DIR}\n\n# copy over the modified server start script\nCOPY start-valheim-server.sh ${VALHEIM_SERVER_DIR}\nWORKDIR ${VALHEIM_SERVER_DIR}\n\n# start the server!\nENTRYPOINT [\"./start-valheim-server.sh\"]\n```\n\nI added comments to explain each part of this new Dockerfile for building a Valheim server image. Of note is that behavior is customized by passing in different values for the environment variables, e.g. one could change the world name by passing in `--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\"` when executing `docker run`.  \n\nWhat does our `start-valheim-server.sh` look like?  Below is what I've come up with:\n\n```bash\n#!/usr/bin/env bash\n\n# docker sends a SIGTERM and then SIGKILL to the main process\n# Valheim needs a SIGINT (CTRL+C) to terminate properly\nfunction shutdownValheimGracefully()\n{\n    echo \"Valheim server PID is: $1\"\n    # send a SIGINT to shut down the Valheim server gracefully\n    kill -2 $1\n    # wait for Valheim to terminate before shutting down the container\n    wait $1\n    exit 0\n}\n\n# catch Docker's SIGTERM, then then a SIGINT to the Valheim server process\ntrap 'shutdownValheimGracefully \"$VALHEIM_PID\"' SIGTERM\n\nexport templdpath=$LD_LIBRARY_PATH\nexport LD_LIBRARY_PATH=./linux64:$LD_LIBRARY_PATH\nexport SteamAppId=892970\n\necho \"Starting server PRESS CTRL-C to exit\"\necho \"LD_LIBRARY_PATH: $LD_LIBRARY_PATH\"\n\necho \"Valheim port is: $VALHEIM_PORT\"\necho \"Valheim server name is: $VALHEIM_SERVER_NAME\"\necho \"Valheim world name is: $VALHEIM_WORLD_NAME\"\n\ncd $VALHEIM_SERVER_DIR\n# start the server as a background process to get its PID (\"&\" at end of command)\n# \"&>>\" means append all stdout and stderr to the log file\n./valheim_server.x86_64 -name $VALHEIM_SERVER_NAME \\\n-port $VALHEIM_PORT \\\n-world $VALHEIM_WORLD_NAME \\\n-password $VALHEIM_PASSWORD \\\n-savedir $VALHEIM_DATA_DIR &>> /home/steam/valheim-data/valheim-logs.txt &\nVALHEIM_PID=$!\necho \"Valheim server PID is: $VALHEIM_PID\"\n\n# since the server is run in the background, this is needed to keep the main process from exiting\nwhile wait $!; [ $? != 0 ]; do true; done\n```\n\nThis script is mostly a copy of the original `start_server.sh` script that comes with Valheim server installation.  I've added comments to explain some of the changes made to accommodate running the server in Docker. Most importantly is providing a graceful shutdown to the running Valheim server, which needs a `SIGINT` signal to properly terminate (equivalent to hitting CTRL+C when running the server manually). Docker sends a `SIGTERM` signal by default. This script traps the `SIGTERM` signal, and then sends a `SIGINT` signal to the Valheim server process (the `kill -2` command) before exiting properly.  Without this behavior, the server would not terminate properly and thus world data would not be saved completely. For more background on why this is necessary, see this wonderful article: [Gracefully Stopping Docker Containers](https://www.ctl.io/developers/blog/post/gracefully-stopping-docker-containers/).  \n\nTo build our image, create a new directory on the host machine and create two files in it called `Dockerfile` and `start-valheim-server.sh`. `Dockerfile` should be exactly the contents of the Dockerfile I provided above, and likewise for the custom start script. Note the file to build the Docker image **must** be named `Dockerfile`. On the host terminal, enter the directory and build the new image using [docker build](https://docs.docker.com/engine/reference/commandline/build/):\n\n```bash\nsethmachine docker % pwd\n/home/sethmachine/valheim/docker\nsethmachine docker % ls\nDockerfile              start-valheim-server.sh\nsethmachine docker % docker build -t sethmachine/valheim-server .\n[+] Building 0.2s (10/10) FINISHED                                                                                                                                          \n => [internal] load build definition from Dockerfile                                                                                                                   0.0s\n => => transferring dockerfile: 1.15kB                                                                                                                                 0.0s\n => [internal] load .dockerignore                                                                                                                                      0.0s\n => => transferring context: 2B                                                                                                                                        0.0s\n => [internal] load metadata for docker.io/cm2network/steamcmd:latest                                                                                                  0.0s\n => [1/5] FROM docker.io/cm2network/steamcmd                                                                                                                           0.0s\n => [internal] load build context                                                                                                                                      0.0s\n => => transferring context: 1.03kB                                                                                                                                    0.0s\n => CACHED [2/5] RUN ./steamcmd.sh +login anonymous +force_install_dir /home/steam/valheim-server +app_update 896660 validate +exit                                    0.0s\n => CACHED [3/5] RUN apt-get update && apt-get install -y procps                                                                                                       0.0s\n => [4/5] COPY start-valheim-server.sh /home/steam/valheim-server                                                                                                      0.0s\n => [5/5] WORKDIR /home/steam/valheim-server                                                                                                                           0.0s\n => exporting to image                                                                                                                                                 0.0s\n => => exporting layers                                                                                                                                                0.0s\n => => writing image sha256:da020f90db05f93dfbcd9f0a2489cb5bcaa6baf9ac2bf9a84a37511c47384972                                                                           0.0s\n => => naming to docker.io/sethmachine/valheim-server                                                                                                                   0.0s \n```\n\n*Note that rebuilding the image will re-use previous layers, including the version of the Valheim server downloaded.  This is both good and bad.  Good because it makes re-building the image very quick.  But it is bad if Valheim has updated the server and Docker's cache has gone stale.  In that case, add the `--no-cache` argument when rebuilding if Valheim has been updated.*\n\nThe new image should now show up when running `docker image ls`:\n\n```bash\nsethmachine % docker image ls | grep \"valheim\"\nsethmachine/valheim-server   latest    da020f90db05   5 minutes ago       1.71GB\n```\n\nCongrats, we have built a Valheim server Docker image!  Now we need to run it as a container.    \n\n## Run the valheim-server image\n\nTo run the Valheim server image, we need to decide where Valheim's worlds data will be stored on the host machine, and then pass in parameters to decide the name, password, and world of the server.  \n\nThe image volume `/home/steam/valheim-data` needs to be bound to a directory on the host machine where all worlds data is persisted. The host machine directory should be empty or contain a subdirectory called `worlds` which can contain already created Valheim worlds. When the Valheim server runs, if the world does not exist in the host directory, then it will be created anew. If the world already does exist (i.e. there are files in the `worlds` subdirectory with the name of the world), then the server will use it as the server's world rather than making a new one. \n\nOn my host machine, I have a directory at `/home/sethmachine/valeim-data` which I will map onto the image's volume.  Here is what it looks like before I run the Valhem server and make a new world:\n\n```bash\nsethmachine valheim-server-docker % tree /home/sethmachine/valeim-data\n/home/sethmachine/valeim-data\n└── worlds\n    ├── OldWorld.db\n    └── OldWorld.fwl\n\n1 directory, 2 files\n```\n\n([tree](https://en.wikipedia.org/wiki/Tree_(command)) is a helpful command to visualize a directory)\n\nThis folder already has an existing world that I copied over, `OldWorld`, but your folder can be completely empty.  \n\nThere are 3 parameters to set when running the server.  The server name and world name **must** be provided at runtime, otherwise the container will exit immediately.  \n\n* `VALHEIM_SERVER_NAME`: the name that will appear in Valheim's server list, truncated at first whitespace\n* `VALHEIM_WORLD_NAME`: the name of the Valheim world (can be an existing world), truncated at first whitespace\n* `VALHEIM_PASSWORD`: the password to join the server (can be set to empty for no password, default is \"password\")\n\nBelow is an example command that runs a Valheim server with the host directory set to `/home/sethmachine/valeim-data`.  Note this container is named `valheim` to make it easier to reference with Docker commands.  \n\n```bash\ndocker run --name=valheim -d \\\n-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\\n-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\\n--env VALHEIM_SERVER_NAME=\"sethmachine'sServer\" \\\n--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\" \\\n--env VALHEIM_PASSWORD=\"HardToGuessPassword\" \\\nsethmachine/valheim-server\n```\nExplanation:\n\n* `docker run`: creates a running container from an image, in this case the image is `sethmachine/valheim-server`\n* `-d`: runs the container in the background\n* `-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp`: exposes and maps ports 2456, 2457, 2458 on the host to the container \n* `--env VALHEIM_SERVER_NAME=\"sethmachine'sServer\"`: sets the server's name\n* `--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\"`: sets the world's name\n* `--env VALHEIM_PASSWORD=\"HardToGuessPassword\"`: sets the server's password\n\nUse `docker container ls` to confirm the server is running:\n\n```bash\nsethmachine valheim-server-docker % docker container ls\nCONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS           NAMES\ndb70c7b20af7   sethmachine/valheim-server   \"./start-valheim-ser…\"   10 minutes ago   Up 10 minutes   2456-2458/udp   valheim\n```\n\nUse `docker logs valheim` to get output information about the server:\n\n```bash\nsethmachine valheim-server-docker % docker logs valheim\nStarting server PRESS CTRL-C to exit\nLD_LIBRARY_PATH: ./linux64:\nValheim port is: 2456\nValheim server name is: sethmachine'sServer\nValheim world name is: AWholeNewWorld\nValheim server PID is: 7\n```\n\nUnder the mounted host directory (mine is `/home/sethmachine/valeim-data`), there should be several files and a \"worlds\" subdirectory:\n\n```bash\nsethmachine valheim-server-docker % tree /home/sethmachine/valeim-data\n/home/sethmachine/valeim-data\n├── AWholeNewWorld-logs.txt\n├── adminlist.txt\n├── bannedlist.txt\n├── permittedlist.txt\n└── worlds\n    ├── AWholeNewWorld.fwl\n    ├── OldWorld.db\n    └── OldWorld.fwl\n\n1 directory, 7 files\n```\n\nWhat each of these files mean:\n\n* `AWholeNewWorld-logs.txt`: this is a Valheim specific log file for the world we created\n* `adminlist.txt`: determines who is an admin (add Steam ID, one per line)\n* `bannedlist.txt`: automatically bans players (add Steam ID, one per line)\n* `permittedlist.txt`: whitelist for who can join (add Steam ID, one per line).  Note if this has a single Steam ID in it, this will ban everyone else from the server besides players whose Steam ID is in this list.\n* `worlds`: directory where Valheim worlds data is stored (including old or already existing worlds)\n\nIf you've seen similar output on your end, then congrats, you are able to run the Valheim server Docker image!\n\nTo stop the server, use `docker stop valheim`.  This will create a new database (`.db`) file for the world as well:\n\n```bash\nsethmachine valheim-server-docker % docker stop valheim\nvalheim\nsethmachine valheim-server-docker % tree /home/sethmachine/valeim-data\n/home/sethmachine/valeim-data\n├── AWholeNewWorld-logs.txt\n├── adminlist.txt\n├── bannedlist.txt\n├── permittedlist.txt\n└── worlds\n    ├── AWholeNewWorld.db\n    ├── AWholeNewWorld.fwl\n    ├── OldWorld.db\n    └── OldWorld.fwl\n\n1 directory, 8 files\n```\n\nNote the new `AWholeNewWorld.db` file.  This contains the save data of the world; because it has been created, we know the Valheim server shut down properly.   \n\nFor the server to be up almost 24/7 we will want it to restart automatically whenever it is turned off (e.g. the host machine restarts or the Docker container somehow crashes, is killed, etc.).  To do this, we specify a [restart policy](https://docs.docker.com/config/containers/start-containers-automatically/) when running the container.  The `always` policy appears appropriate, as it means the server will automatically run whenever Docker restarts.  Only manually stopping the server with `docker stop` will prevent it from automatically restarting.  Finally, this gives us a suitable command to begin running our server indefinitely!\n\n```bash\ndocker run --name=valheim -d \\\n--restart always \\\n-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\\n-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\\n--env VALHEIM_SERVER_NAME=\"sethmachine'sServer\" \\\n--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\" \\\n--env VALHEIM_PASSWORD=\"HardToGuessPassword\" \\\nsethmachine/valheim-server\n```\n\nWith `--restart always` and Docker Desktop set to restart on log in, our server should be up and running all the time once we execute the above command.  Note you can still use `docker stop valheim` followed by `docker rm valheim` to stop the server completely (e.g. you want to run a different world or take a break).\n\n## Port Forwarding\n\n*This step is highly dependent upon your internet service provider and firewall settings of the host machine.  You will likely need to do additional research to open the ports on your host machine*\n\nHosting a dedicated server requires allowing incoming connections from the ports the Valheim server uses.  These ports are 2456, 2457, and 2458 (UDP protocol).  Without these ports open, your server will not be visible and your friends cannot play with you.  \n\nIn general you will need to follow these steps:\n\n* Disable any firewall software on your host machine.  If you know how to modify your firewall just for the Valheim ports, feel free to do so instead.  \n* Find your router's IP address and then log in to it, e.g. see [How to Log In to Your Router](https://www.highspeedinternet.com/resources/how-to-log-in-to-your-router)  \n* In the router admin controls, find where to add port forwarding rules.\n\n![](router-port-forwarding-location.png)\n\n* Find the LAN IP address of the host machine, e.g. see: [Find your LAN IP address](https://uca.edu/it/knowledgebase-legacy/finding-your-ip-address-lan/).  The LAN IP is the IP assigned to the host machine within your local/home network.  \n* Create 3 new port forwarding rules for the host machine's LAN IP that allow any traffic to 2456, 2457, and 2458, all for UDP. \n\n![](show-forwarded-ports-2456-2457-2458.png)\n\nWe can use external tools and websites to see if the ports were opened correctly.  \n\n* Turn on the Valheim server if it is not already running.     \n* First, find your public IP address.  Head to [whatsmyip.com](https://www.whatismyip.com/) and keep a note of the IP v4 address.  Note most home ISPs use dynamic IPs, so at some point your IP will change and you will have to update any configurations based on the your public IP.  \n* Head to [check-host.net](https://check-host.net/) and put in your public IP address followed by a colon and then the port number.  We will test each port (2456, 2457, 2458) individually.  Then hit the \"UDP port\" button.  If your ports are open you should see similar results to mine below.  If you see \"Open or Filtered\" it means it's working.  If you see \"Connection Refused\", re-check your port forwarding settings and make sure the Valheim server is running.  \n\n![](show-check-host-ports-open.png)\n\n\n\n## Access your server on Steam\n\nWith the server running and the proper ports exposed, we can finally use the server on Steam!  \n\nHead to your Steam client and access servers from the view menu:\n\n![](steam-view-servers-menu.png)\n\nThis will open a new window to manage servers.  Select the \"Favorites\" tab and then \"Add a server\".  Enter your IPv4 address followed by port `2457`, then add the server:\n\n![](steam-add-server.png)\n\nIf it works, you'll see your server listed like mine:\n\n![](steam-server-listed.png)\n\nIf you do not see anything, trying hitting the refresh button.  If your server is listed as offline or unable to connect, re-visit the previous steps. Make sure your server is actually running.  Make sure ports 2456, 2457, and 2458 are exposed.  \n\nFinally, we can actually join the server in Valheim!  \n\n![](valeheim-see-server.png)\n\n## Final thoughts\n\nWe were able to successfully run the Valheim server on a Docker container, and allow it to be accessible so others can join!  We created a custom start script so the server would shut down properly and save world data.\n\nI've made a Docker image available on Docker Hub and the corresponding Dockerfile and script on GitHub:\n\n* Docker Hub: [sethmachineio/valheim-server](https://hub.docker.com/r/sethmachineio/valheim-server)\n* GitHub: [valheim-server-docker](https://github.com/sethmachine/valheim-server-docker)\n\nFeel free to leave a comment if you found this helpful, have any feedback, or are stuck on any parts of this guide.  I'll do my best to respond and help you!  \n\n### Follow up tasks\n\nThere a few improvements we can make to make the Valheim server easier to use.  I will address these in a separate follow-up guide.  \n\n* Automatically updating the server software without rebuilding the Docker image.  When Valheim provides updates to its game client, players on the newer client cannot join servers running on older versions of Valheim.  Right now to fix this requires stopping the server and building a new image using the `--no-cache` option.  As a follow-up we should modify the running container to automatically update itself whenever Valheim is updated.  \n* Create backups of worlds periodically.  If anything should happen to the worlds save file (corrupted, accidentally deleted, someone griefs the server), it would be nice to have backups to revert to.  \n\n","source":"_posts/host-valheim-with-docker.md","raw":"---\ntitle: Host Valheim with Docker\ndate: 2021-02-10 21:14:51\ntags: \n- Docker\n- Valheim\n- Steam\n- Port Forwarding\n- Dedicated Server\n---\n## Introduction\n\n![Valheim Dedicated Server with Docker](valheim-dedicated-server-logo.jpg)\n\nThis guide explains how to host a dedicated Valheim server with Docker that can be run at home while still being publicly accessible over the internet so your friends can join anytime.  Ideally the server is hosted on a spare computer, but it can still run on the same computer you play on.   \n\nFor those unfamiliar, [Valheim](https://store.steampowered.com/app/892970/Valheim/) is a builder-survival that is akin to Minecraft but much darker and focused on a Viking theme, which has gone viral with over 1 million purchases in its first weeks. Now is a better time than ever to start playing!\n\nIf you've worked with Docker before and know what you're doing, feel free to jump straight to using the image I built:\n\n* Docker Hub: [sethmachineio/valheim-server](https://hub.docker.com/r/sethmachineio/valheim-server)\n* GitHub: [valheim-server-docker](https://github.com/sethmachine/valheim-server-docker)\n\n## Why host your own?\n\nValheim does have \"peer-to-peer\" hosting. But if the host logs off, then the world is no longer accessible to anyone and everyone else gets removed from the world. Hosting a dedicated Valheim server solves this by being accessible 24/7, so your friends can play even if you're not online. This makes the experience all the more immersive.  \n\nHosting at home also means a lot of cost savings. It's already possible to rent a dedicated Valheim server for around [$12/month](https://www.g-portal.com/us/en/gameserver/valheim-server-hosting?gclid=CjwKCAiA65iBBhB-EiwAW253Wwfyd6STzTQV4yvvwD_GBJHvuZDQkZNDuSTUMHexNYkIT_Z0zVPSDhoCzUkQAvD_BwE). However, I estimate my 2013 iMac would only cost around $7/month to run 24/7 (assuming the monitor is completely turned off). See: [iMac energy consumption](https://support.apple.com/en-us/HT201918) and [Electricity usage of a Computer calculator](https://energyusecalculator.com/electricity_computer.htm#:~:text=We%20estimate%20that%20an%20average,not%20including%20the%20display%20screen.).  I used 100 watts as an estimate. That is a cost savings of over 40%!\n\nIn summary:\n\n* You want a dedicated server running 24/7.\n* You want to save over 40% compared to renting a dedicated server (or buying compute from AWS/Google Cloud, etc.).\n* You want to have fun on a mini project and learn about Docker/hosting.\n\n## About Docker\n[Docker](https://www.docker.com/why-docker) allows for a repeatable and configurable process to manage running the Valheim server. Meaning if we ever need to update the server, we simply rebuild it in a single command with Docker. As a Docker container, the server can be run on any computer that also runs Docker. This means it's easy to move the server to another computer if needed (e.g. more resources such as memory). Further, we can take advantage of Docker's automatic restart policies, so the server will automatically turn back on if the host machine restarts.\n\nIf you want to host on macOS, Docker is absolute requirement, as Valheim is only supported on Windows and Linux.  Using the steps in this guide I have been able to host my Valheim server on my 2013 iMac.  Note that playing the actual game must be done on Windows or Linux.     \n \n## Prerequisites\n\n* You have access to the PC to run the server.\n* You are comfortable using the terminal/command prompt.  \n* You have admin access to your router/ISP so you can change firewall and port forwarding rules.\n* The host machine is able to run Docker.  \n* The host machine is able to run 24/7.  \n\n## Setup Docker\n\nDownload and install [Docker Desktop](https://www.docker.com/products/docker-desktop) on the host machine. I installed it on macOS but same steps apply if you are using Windows or Linux. You may get prompted for a tutorial when starting Docker Desktop for the first time, feel free to complete it if you aren't familiar with Docker.  \n\nOnce installed, head to Docker's preferences to change resources and restart policy. Make sure to check the checkbox \"Start Docker Desktop when you log in\".    \n\n![](docker-restart-on-log-in.png)\n\nChange the amount of memory, CPUs, and disk space Docker is allocated.  Any running Docker containers won't exceed the amounts here. If the host machine is just running the Valheim server, I'd recommend to allocate all available memory and CPUs to maximize performance. The disk image size constraints how much storage Docker can use before it \"runs out\"; I set mine to around 50 GB.  After making changes, hit \"Apply and Restart\" for it to take effect.   \n  \n![](change-docker-memory-cpus.png)\n\nFor next steps, we will be using Docker's command line interface (CLI) called `docker`. The CLI is only available if Docker Desktop is running. To make sure it's working, open a Terminal or Command Prompt and type in `docker ps`. You should see output similar to below.  \n\n```bash\nsethmachine % docker ps\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n``` \n\n## Run Valheim on Docker\n\nNow we need to download the Valheim server and somehow run it on Docker. Steam provides [SteamCMD](https://developer.valvesoftware.com/wiki/SteamCMD) which is a command-line interface of the Steam client. It can be used to programmatically download Steam games and servers. We will use it to download the Valheim server. Thankfully there is already an existing Docker image that comes with SteamCMD ready to use: [cm2network/steamcmd](https://hub.docker.com/r/cm2network/steamcmd).  \n\nDownload the Docker image:\n\n```bash\nsethmachine % docker pull cm2network/steamcmd\nUsing default tag: latest\nlatest: Pulling from cm2network/steamcmd\n45b42c59be33: Pull complete \na4d9e5a1b4b0: Pull complete \nDigest: sha256:0bd046d574a92bdd7a020beb9a8bc4ab8498d96422c005893316800d630a58c3\nStatus: Downloaded newer image for cm2network/steamcmd:latest\ndocker.io/cm2network/steamcmd:latest\n``` \n\nNext let's run the image in interactive mode to make sure it works and see how we could run a Valheim server.  \n\n```bash\nsethmachine % docker run -it --name=steamcmd cm2network/steamcmd\nsteam@cf87295af3ac:~/steamcmd$ \n``` \n\nYou should notice your command prompt has changed.  We are now in the running Docker container in interactive mode. Some things to note:\n \n * The Docker container will stop running if you exit (e.g. CTRL+D)\n * While the container is running, use `docker ps` to find its container ID (host machine terminal)\n * The running container is named `steamcmd` (from `--name=steamcmd`).  \n * The same container can be re-activated by using `docker start --interactive steamcmd`\n * To delete the named container, use `docker rm steamcmd`.  \n\nWith SteamCMD, we can now install the Valheim server. We need its ID which happens to be `896660`. I found this information on steamdb.com: [Valheim Server](https://steamdb.info/app/896660/).  \n\nRun the following command to install the Valheim server in the running Docker container:\n\n```bash\n./steamcmd.sh +login anonymous \\\n+force_install_dir valheimserver/ \\\n+app_update 896660 \\\nvalidate +exit \n```\n\nAfter a minute you should see a message like \"Success! App '896660' fully installed.\"\n\nIn the current directory, there is now a `valheimserver/` folder:\n\n```shell\nsteam@cf87295af3ac:~/steamcmd$ ls valheimserver/\n LinuxPlayer_s.debug   UnityPlayer_s.debug                    linux64           start_server.sh         steam_appid.txt   steamclient.so          valheim_server_Data\n UnityPlayer.so       'Valheim Dedicated Server Manual.pdf'   server_exit.drp   start_server_xterm.sh   steamapps         valheim_server.x86_64\n```\n\nThe server install includes a manual which I've also made available here: [Valheim Dedicated Server Manual](/misc/valheim-dedicated-server-manual.pdf) (disclaimer: the manual is subject to change so this link may become outdated). The manual explains how to run the Valheim server and its different configurable options.  Below is the command I used to copy the manual from the running Docker container. This command is run from the host machine's terminal and not within the Docker container.  \n\n```bash\ndocker cp steamcmd:/home/steam/steamcmd/valheimserver/'Valheim Dedicated Server Manual.pdf' ~/desktop\n```\n\nAccording to the manual, we should make a copy of `start_server.sh` and supply it with our parameters. The line to edit:\n\n```shell\n./valheim_server.x86_64 -name \"My server\" -port 2456 -world \"Dedicated\" -password \"secret\"\n```\n\nThe parameters (also explained in the manual):\n\n* `-name`: the name of the server that will appear in the server list\n* `-port`: the port the server will run on.  Keep the default as `2456`.  \n* `-world`: the name of the World that will be created, or the existing World to use.  \n* `-password`: the password to enter the server.  Must be at least 5 characters.  \n* `-savedir`: where the server loads and saves the World data (not in the example as it is optional)\n\nTo create and edit a copy of `start_server.sh`:\n\n* Copy with `cp start_server.sh example-start-server.sh` then edit with `nano` (while in the Docker container). \n* Or, copy the file to the host machine, edit it there, and then copy it back to Docker\n    * Copy file to host machine to desktop: `docker cp steamcmd:/home/steam/steamcmd/valheimserver/start_server.sh ~/desktop`\n    * Edit and save as `example-start-server.sh`.  \n    * Copy back to the Docker container: `docker cp example-start-server.sh steamcmd:/home/steam/steamcmd/valheimserver`\n\nAfter editing this is what my `example-start-server.sh` looks like (I removed the comments):\n\n```bash\nexport templdpath=$LD_LIBRARY_PATH\nexport LD_LIBRARY_PATH=./linux64:$LD_LIBRARY_PATH\nexport SteamAppId=892970\n\necho \"Starting server PRESS CTRL-C to exit\"\n\n./valheim_server.x86_64 -name \"Example Server\" -port 2456 -world \"HelloWorld\" -password \"password123\"\n\nexport LD_LIBRARY_PATH=$templdpath\n```\n\nNow run it by entering `./example-start-server.sh` in the Docker container. It should spit out a lot of different debug output. Of interest is it prints the world seed generated (since we did not use the `-savedir` parameter to an existing world).  \n\n```bash\n02/13/2021 03:09:44: Initializing world generator seed:85nRPRACxA ( -1305926156 )   menu:False  worldgen version:1\n```\n\nWe can also see where the generated world is stored by default (according to the manual):\n\n```bash\nsteam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/\nadminlist.txt  bannedlist.txt  permittedlist.txt  prefs  worlds\nsteam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/worlds\nHelloWorld.db  HelloWorld.fwl\n```\n\nPress CTRL+C to stop the server from running.   \n\nCongrats!  If you've got this far, it means you can now run a Valheim server on Docker!  There are a few more steps to consolidate what we've learned and then we have to open ports before your dedicated at home server is ready.\n\n## Create a Docker image\n\nWe did a bit of work in the previous steps and it'd be nice to avoid having to repeat it. Luckily, Docker provides [Dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/), which can be used to build new Docker images from existing Docker images. Our goal here is to make a new Docker image that automatically starts the Valheim server without having to enter the container and manually enter commands as we did before. The Valheim server also needs to be shutdown gracefully so that current world data is properly saved whenever the container is stopped or restarted.  \n\nThe Valheim server Docker image should be as generic as possible while allowing a user to customize server specific behavior at runtime (e.g. which world to use, what the password is, etc.). The strategy to do this is to separate the environment and installation setup from the actual command to start the server. This means we will write a custom script to start the Valheim server that controls how the server is started and shutdown. The Valheim server also needs to persist the worlds data into the host machine (as the containers are meant to be ephemeral). Persistence is accomplished by [binding a directory from the host machine to a Docker volume](https://docs.docker.com/storage/bind-mounts/) (this is also how we can add existing worlds to the server).  \n\nGiven all that, here is our Dockerfile to build the Valheim server image:\n\n```dockerfile\nFROM cm2network/steamcmd\n\n# where the Valheim server is installed to\nENV VALHEIM_SERVER_DIR \"/home/steam/valheim-server\"\n\n# install the Valheim server\nRUN ./steamcmd.sh +login anonymous \\\n+force_install_dir $VALHEIM_SERVER_DIR \\\n+app_update 896660 \\\nvalidate +exit\n\n# where world data is stored, map this to the host directory where your worlds are stored\n# e.g. docker run -v /path/to/host/directory:/home/steam/valheim-data\nENV VALHEIM_DATA_DIR \"/home/steam/valheim-data\"\n# don't change the port unless you know what you are doing\nENV VALHEIM_PORT 2456\n# server and world name are truncated after 1st white space\n# you must set values to the server and world name otherwise the container will exit immediately\nENV VALHEIM_SERVER_NAME=\"\"\nENV VALHEIM_WORLD_NAME=\"\"\nENV VALHEIM_PASSWORD \"password\"\n\n# the server needs these 3 ports exposed by default\nEXPOSE 2456/udp\nEXPOSE 2457/udp\nEXPOSE 2458/udp\n\nVOLUME ${VALHEIM_DATA_DIR}\n\n# copy over the modified server start script\nCOPY start-valheim-server.sh ${VALHEIM_SERVER_DIR}\nWORKDIR ${VALHEIM_SERVER_DIR}\n\n# start the server!\nENTRYPOINT [\"./start-valheim-server.sh\"]\n```\n\nI added comments to explain each part of this new Dockerfile for building a Valheim server image. Of note is that behavior is customized by passing in different values for the environment variables, e.g. one could change the world name by passing in `--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\"` when executing `docker run`.  \n\nWhat does our `start-valheim-server.sh` look like?  Below is what I've come up with:\n\n```bash\n#!/usr/bin/env bash\n\n# docker sends a SIGTERM and then SIGKILL to the main process\n# Valheim needs a SIGINT (CTRL+C) to terminate properly\nfunction shutdownValheimGracefully()\n{\n    echo \"Valheim server PID is: $1\"\n    # send a SIGINT to shut down the Valheim server gracefully\n    kill -2 $1\n    # wait for Valheim to terminate before shutting down the container\n    wait $1\n    exit 0\n}\n\n# catch Docker's SIGTERM, then then a SIGINT to the Valheim server process\ntrap 'shutdownValheimGracefully \"$VALHEIM_PID\"' SIGTERM\n\nexport templdpath=$LD_LIBRARY_PATH\nexport LD_LIBRARY_PATH=./linux64:$LD_LIBRARY_PATH\nexport SteamAppId=892970\n\necho \"Starting server PRESS CTRL-C to exit\"\necho \"LD_LIBRARY_PATH: $LD_LIBRARY_PATH\"\n\necho \"Valheim port is: $VALHEIM_PORT\"\necho \"Valheim server name is: $VALHEIM_SERVER_NAME\"\necho \"Valheim world name is: $VALHEIM_WORLD_NAME\"\n\ncd $VALHEIM_SERVER_DIR\n# start the server as a background process to get its PID (\"&\" at end of command)\n# \"&>>\" means append all stdout and stderr to the log file\n./valheim_server.x86_64 -name $VALHEIM_SERVER_NAME \\\n-port $VALHEIM_PORT \\\n-world $VALHEIM_WORLD_NAME \\\n-password $VALHEIM_PASSWORD \\\n-savedir $VALHEIM_DATA_DIR &>> /home/steam/valheim-data/valheim-logs.txt &\nVALHEIM_PID=$!\necho \"Valheim server PID is: $VALHEIM_PID\"\n\n# since the server is run in the background, this is needed to keep the main process from exiting\nwhile wait $!; [ $? != 0 ]; do true; done\n```\n\nThis script is mostly a copy of the original `start_server.sh` script that comes with Valheim server installation.  I've added comments to explain some of the changes made to accommodate running the server in Docker. Most importantly is providing a graceful shutdown to the running Valheim server, which needs a `SIGINT` signal to properly terminate (equivalent to hitting CTRL+C when running the server manually). Docker sends a `SIGTERM` signal by default. This script traps the `SIGTERM` signal, and then sends a `SIGINT` signal to the Valheim server process (the `kill -2` command) before exiting properly.  Without this behavior, the server would not terminate properly and thus world data would not be saved completely. For more background on why this is necessary, see this wonderful article: [Gracefully Stopping Docker Containers](https://www.ctl.io/developers/blog/post/gracefully-stopping-docker-containers/).  \n\nTo build our image, create a new directory on the host machine and create two files in it called `Dockerfile` and `start-valheim-server.sh`. `Dockerfile` should be exactly the contents of the Dockerfile I provided above, and likewise for the custom start script. Note the file to build the Docker image **must** be named `Dockerfile`. On the host terminal, enter the directory and build the new image using [docker build](https://docs.docker.com/engine/reference/commandline/build/):\n\n```bash\nsethmachine docker % pwd\n/home/sethmachine/valheim/docker\nsethmachine docker % ls\nDockerfile              start-valheim-server.sh\nsethmachine docker % docker build -t sethmachine/valheim-server .\n[+] Building 0.2s (10/10) FINISHED                                                                                                                                          \n => [internal] load build definition from Dockerfile                                                                                                                   0.0s\n => => transferring dockerfile: 1.15kB                                                                                                                                 0.0s\n => [internal] load .dockerignore                                                                                                                                      0.0s\n => => transferring context: 2B                                                                                                                                        0.0s\n => [internal] load metadata for docker.io/cm2network/steamcmd:latest                                                                                                  0.0s\n => [1/5] FROM docker.io/cm2network/steamcmd                                                                                                                           0.0s\n => [internal] load build context                                                                                                                                      0.0s\n => => transferring context: 1.03kB                                                                                                                                    0.0s\n => CACHED [2/5] RUN ./steamcmd.sh +login anonymous +force_install_dir /home/steam/valheim-server +app_update 896660 validate +exit                                    0.0s\n => CACHED [3/5] RUN apt-get update && apt-get install -y procps                                                                                                       0.0s\n => [4/5] COPY start-valheim-server.sh /home/steam/valheim-server                                                                                                      0.0s\n => [5/5] WORKDIR /home/steam/valheim-server                                                                                                                           0.0s\n => exporting to image                                                                                                                                                 0.0s\n => => exporting layers                                                                                                                                                0.0s\n => => writing image sha256:da020f90db05f93dfbcd9f0a2489cb5bcaa6baf9ac2bf9a84a37511c47384972                                                                           0.0s\n => => naming to docker.io/sethmachine/valheim-server                                                                                                                   0.0s \n```\n\n*Note that rebuilding the image will re-use previous layers, including the version of the Valheim server downloaded.  This is both good and bad.  Good because it makes re-building the image very quick.  But it is bad if Valheim has updated the server and Docker's cache has gone stale.  In that case, add the `--no-cache` argument when rebuilding if Valheim has been updated.*\n\nThe new image should now show up when running `docker image ls`:\n\n```bash\nsethmachine % docker image ls | grep \"valheim\"\nsethmachine/valheim-server   latest    da020f90db05   5 minutes ago       1.71GB\n```\n\nCongrats, we have built a Valheim server Docker image!  Now we need to run it as a container.    \n\n## Run the valheim-server image\n\nTo run the Valheim server image, we need to decide where Valheim's worlds data will be stored on the host machine, and then pass in parameters to decide the name, password, and world of the server.  \n\nThe image volume `/home/steam/valheim-data` needs to be bound to a directory on the host machine where all worlds data is persisted. The host machine directory should be empty or contain a subdirectory called `worlds` which can contain already created Valheim worlds. When the Valheim server runs, if the world does not exist in the host directory, then it will be created anew. If the world already does exist (i.e. there are files in the `worlds` subdirectory with the name of the world), then the server will use it as the server's world rather than making a new one. \n\nOn my host machine, I have a directory at `/home/sethmachine/valeim-data` which I will map onto the image's volume.  Here is what it looks like before I run the Valhem server and make a new world:\n\n```bash\nsethmachine valheim-server-docker % tree /home/sethmachine/valeim-data\n/home/sethmachine/valeim-data\n└── worlds\n    ├── OldWorld.db\n    └── OldWorld.fwl\n\n1 directory, 2 files\n```\n\n([tree](https://en.wikipedia.org/wiki/Tree_(command)) is a helpful command to visualize a directory)\n\nThis folder already has an existing world that I copied over, `OldWorld`, but your folder can be completely empty.  \n\nThere are 3 parameters to set when running the server.  The server name and world name **must** be provided at runtime, otherwise the container will exit immediately.  \n\n* `VALHEIM_SERVER_NAME`: the name that will appear in Valheim's server list, truncated at first whitespace\n* `VALHEIM_WORLD_NAME`: the name of the Valheim world (can be an existing world), truncated at first whitespace\n* `VALHEIM_PASSWORD`: the password to join the server (can be set to empty for no password, default is \"password\")\n\nBelow is an example command that runs a Valheim server with the host directory set to `/home/sethmachine/valeim-data`.  Note this container is named `valheim` to make it easier to reference with Docker commands.  \n\n```bash\ndocker run --name=valheim -d \\\n-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\\n-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\\n--env VALHEIM_SERVER_NAME=\"sethmachine'sServer\" \\\n--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\" \\\n--env VALHEIM_PASSWORD=\"HardToGuessPassword\" \\\nsethmachine/valheim-server\n```\nExplanation:\n\n* `docker run`: creates a running container from an image, in this case the image is `sethmachine/valheim-server`\n* `-d`: runs the container in the background\n* `-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp`: exposes and maps ports 2456, 2457, 2458 on the host to the container \n* `--env VALHEIM_SERVER_NAME=\"sethmachine'sServer\"`: sets the server's name\n* `--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\"`: sets the world's name\n* `--env VALHEIM_PASSWORD=\"HardToGuessPassword\"`: sets the server's password\n\nUse `docker container ls` to confirm the server is running:\n\n```bash\nsethmachine valheim-server-docker % docker container ls\nCONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS           NAMES\ndb70c7b20af7   sethmachine/valheim-server   \"./start-valheim-ser…\"   10 minutes ago   Up 10 minutes   2456-2458/udp   valheim\n```\n\nUse `docker logs valheim` to get output information about the server:\n\n```bash\nsethmachine valheim-server-docker % docker logs valheim\nStarting server PRESS CTRL-C to exit\nLD_LIBRARY_PATH: ./linux64:\nValheim port is: 2456\nValheim server name is: sethmachine'sServer\nValheim world name is: AWholeNewWorld\nValheim server PID is: 7\n```\n\nUnder the mounted host directory (mine is `/home/sethmachine/valeim-data`), there should be several files and a \"worlds\" subdirectory:\n\n```bash\nsethmachine valheim-server-docker % tree /home/sethmachine/valeim-data\n/home/sethmachine/valeim-data\n├── AWholeNewWorld-logs.txt\n├── adminlist.txt\n├── bannedlist.txt\n├── permittedlist.txt\n└── worlds\n    ├── AWholeNewWorld.fwl\n    ├── OldWorld.db\n    └── OldWorld.fwl\n\n1 directory, 7 files\n```\n\nWhat each of these files mean:\n\n* `AWholeNewWorld-logs.txt`: this is a Valheim specific log file for the world we created\n* `adminlist.txt`: determines who is an admin (add Steam ID, one per line)\n* `bannedlist.txt`: automatically bans players (add Steam ID, one per line)\n* `permittedlist.txt`: whitelist for who can join (add Steam ID, one per line).  Note if this has a single Steam ID in it, this will ban everyone else from the server besides players whose Steam ID is in this list.\n* `worlds`: directory where Valheim worlds data is stored (including old or already existing worlds)\n\nIf you've seen similar output on your end, then congrats, you are able to run the Valheim server Docker image!\n\nTo stop the server, use `docker stop valheim`.  This will create a new database (`.db`) file for the world as well:\n\n```bash\nsethmachine valheim-server-docker % docker stop valheim\nvalheim\nsethmachine valheim-server-docker % tree /home/sethmachine/valeim-data\n/home/sethmachine/valeim-data\n├── AWholeNewWorld-logs.txt\n├── adminlist.txt\n├── bannedlist.txt\n├── permittedlist.txt\n└── worlds\n    ├── AWholeNewWorld.db\n    ├── AWholeNewWorld.fwl\n    ├── OldWorld.db\n    └── OldWorld.fwl\n\n1 directory, 8 files\n```\n\nNote the new `AWholeNewWorld.db` file.  This contains the save data of the world; because it has been created, we know the Valheim server shut down properly.   \n\nFor the server to be up almost 24/7 we will want it to restart automatically whenever it is turned off (e.g. the host machine restarts or the Docker container somehow crashes, is killed, etc.).  To do this, we specify a [restart policy](https://docs.docker.com/config/containers/start-containers-automatically/) when running the container.  The `always` policy appears appropriate, as it means the server will automatically run whenever Docker restarts.  Only manually stopping the server with `docker stop` will prevent it from automatically restarting.  Finally, this gives us a suitable command to begin running our server indefinitely!\n\n```bash\ndocker run --name=valheim -d \\\n--restart always \\\n-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\\n-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\\n--env VALHEIM_SERVER_NAME=\"sethmachine'sServer\" \\\n--env VALHEIM_WORLD_NAME=\"AWholeNewWorld\" \\\n--env VALHEIM_PASSWORD=\"HardToGuessPassword\" \\\nsethmachine/valheim-server\n```\n\nWith `--restart always` and Docker Desktop set to restart on log in, our server should be up and running all the time once we execute the above command.  Note you can still use `docker stop valheim` followed by `docker rm valheim` to stop the server completely (e.g. you want to run a different world or take a break).\n\n## Port Forwarding\n\n*This step is highly dependent upon your internet service provider and firewall settings of the host machine.  You will likely need to do additional research to open the ports on your host machine*\n\nHosting a dedicated server requires allowing incoming connections from the ports the Valheim server uses.  These ports are 2456, 2457, and 2458 (UDP protocol).  Without these ports open, your server will not be visible and your friends cannot play with you.  \n\nIn general you will need to follow these steps:\n\n* Disable any firewall software on your host machine.  If you know how to modify your firewall just for the Valheim ports, feel free to do so instead.  \n* Find your router's IP address and then log in to it, e.g. see [How to Log In to Your Router](https://www.highspeedinternet.com/resources/how-to-log-in-to-your-router)  \n* In the router admin controls, find where to add port forwarding rules.\n\n![](router-port-forwarding-location.png)\n\n* Find the LAN IP address of the host machine, e.g. see: [Find your LAN IP address](https://uca.edu/it/knowledgebase-legacy/finding-your-ip-address-lan/).  The LAN IP is the IP assigned to the host machine within your local/home network.  \n* Create 3 new port forwarding rules for the host machine's LAN IP that allow any traffic to 2456, 2457, and 2458, all for UDP. \n\n![](show-forwarded-ports-2456-2457-2458.png)\n\nWe can use external tools and websites to see if the ports were opened correctly.  \n\n* Turn on the Valheim server if it is not already running.     \n* First, find your public IP address.  Head to [whatsmyip.com](https://www.whatismyip.com/) and keep a note of the IP v4 address.  Note most home ISPs use dynamic IPs, so at some point your IP will change and you will have to update any configurations based on the your public IP.  \n* Head to [check-host.net](https://check-host.net/) and put in your public IP address followed by a colon and then the port number.  We will test each port (2456, 2457, 2458) individually.  Then hit the \"UDP port\" button.  If your ports are open you should see similar results to mine below.  If you see \"Open or Filtered\" it means it's working.  If you see \"Connection Refused\", re-check your port forwarding settings and make sure the Valheim server is running.  \n\n![](show-check-host-ports-open.png)\n\n\n\n## Access your server on Steam\n\nWith the server running and the proper ports exposed, we can finally use the server on Steam!  \n\nHead to your Steam client and access servers from the view menu:\n\n![](steam-view-servers-menu.png)\n\nThis will open a new window to manage servers.  Select the \"Favorites\" tab and then \"Add a server\".  Enter your IPv4 address followed by port `2457`, then add the server:\n\n![](steam-add-server.png)\n\nIf it works, you'll see your server listed like mine:\n\n![](steam-server-listed.png)\n\nIf you do not see anything, trying hitting the refresh button.  If your server is listed as offline or unable to connect, re-visit the previous steps. Make sure your server is actually running.  Make sure ports 2456, 2457, and 2458 are exposed.  \n\nFinally, we can actually join the server in Valheim!  \n\n![](valeheim-see-server.png)\n\n## Final thoughts\n\nWe were able to successfully run the Valheim server on a Docker container, and allow it to be accessible so others can join!  We created a custom start script so the server would shut down properly and save world data.\n\nI've made a Docker image available on Docker Hub and the corresponding Dockerfile and script on GitHub:\n\n* Docker Hub: [sethmachineio/valheim-server](https://hub.docker.com/r/sethmachineio/valheim-server)\n* GitHub: [valheim-server-docker](https://github.com/sethmachine/valheim-server-docker)\n\nFeel free to leave a comment if you found this helpful, have any feedback, or are stuck on any parts of this guide.  I'll do my best to respond and help you!  \n\n### Follow up tasks\n\nThere a few improvements we can make to make the Valheim server easier to use.  I will address these in a separate follow-up guide.  \n\n* Automatically updating the server software without rebuilding the Docker image.  When Valheim provides updates to its game client, players on the newer client cannot join servers running on older versions of Valheim.  Right now to fix this requires stopping the server and building a new image using the `--no-cache` option.  As a follow-up we should modify the running container to automatically update itself whenever Valheim is updated.  \n* Create backups of worlds periodically.  If anything should happen to the worlds save file (corrupted, accidentally deleted, someone griefs the server), it would be nice to have backups to revert to.  \n\n","slug":"host-valheim-with-docker","published":1,"updated":"2021-03-07T22:59:43.757Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cklzrqf4p0003dunhbtp1hwm9","content":"<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p><img src=\"/2021/02/10/host-valheim-with-docker/valheim-dedicated-server-logo.jpg\" alt=\"Valheim Dedicated Server with Docker\"></p>\n<p>This guide explains how to host a dedicated Valheim server with Docker that can be run at home while still being publicly accessible over the internet so your friends can join anytime.  Ideally the server is hosted on a spare computer, but it can still run on the same computer you play on.   </p>\n<p>For those unfamiliar, <a href=\"https://store.steampowered.com/app/892970/Valheim/\">Valheim</a> is a builder-survival that is akin to Minecraft but much darker and focused on a Viking theme, which has gone viral with over 1 million purchases in its first weeks. Now is a better time than ever to start playing!</p>\n<p>If you’ve worked with Docker before and know what you’re doing, feel free to jump straight to using the image I built:</p>\n<ul>\n<li>Docker Hub: <a href=\"https://hub.docker.com/r/sethmachineio/valheim-server\">sethmachineio/valheim-server</a></li>\n<li>GitHub: <a href=\"https://github.com/sethmachine/valheim-server-docker\">valheim-server-docker</a></li>\n</ul>\n<h2 id=\"Why-host-your-own\"><a href=\"#Why-host-your-own\" class=\"headerlink\" title=\"Why host your own?\"></a>Why host your own?</h2><p>Valheim does have “peer-to-peer” hosting. But if the host logs off, then the world is no longer accessible to anyone and everyone else gets removed from the world. Hosting a dedicated Valheim server solves this by being accessible 24/7, so your friends can play even if you’re not online. This makes the experience all the more immersive.  </p>\n<p>Hosting at home also means a lot of cost savings. It’s already possible to rent a dedicated Valheim server for around <a href=\"https://www.g-portal.com/us/en/gameserver/valheim-server-hosting?gclid=CjwKCAiA65iBBhB-EiwAW253Wwfyd6STzTQV4yvvwD_GBJHvuZDQkZNDuSTUMHexNYkIT_Z0zVPSDhoCzUkQAvD_BwE\">$12/month</a>. However, I estimate my 2013 iMac would only cost around $7/month to run 24/7 (assuming the monitor is completely turned off). See: <a href=\"https://support.apple.com/en-us/HT201918\">iMac energy consumption</a> and <a href=\"https://energyusecalculator.com/electricity_computer.htm#:~:text=We%20estimate%20that%20an%20average,not%20including%20the%20display%20screen.\">Electricity usage of a Computer calculator</a>.  I used 100 watts as an estimate. That is a cost savings of over 40%!</p>\n<p>In summary:</p>\n<ul>\n<li>You want a dedicated server running 24/7.</li>\n<li>You want to save over 40% compared to renting a dedicated server (or buying compute from AWS/Google Cloud, etc.).</li>\n<li>You want to have fun on a mini project and learn about Docker/hosting.</li>\n</ul>\n<h2 id=\"About-Docker\"><a href=\"#About-Docker\" class=\"headerlink\" title=\"About Docker\"></a>About Docker</h2><p><a href=\"https://www.docker.com/why-docker\">Docker</a> allows for a repeatable and configurable process to manage running the Valheim server. Meaning if we ever need to update the server, we simply rebuild it in a single command with Docker. As a Docker container, the server can be run on any computer that also runs Docker. This means it’s easy to move the server to another computer if needed (e.g. more resources such as memory). Further, we can take advantage of Docker’s automatic restart policies, so the server will automatically turn back on if the host machine restarts.</p>\n<p>If you want to host on macOS, Docker is absolute requirement, as Valheim is only supported on Windows and Linux.  Using the steps in this guide I have been able to host my Valheim server on my 2013 iMac.  Note that playing the actual game must be done on Windows or Linux.     </p>\n<h2 id=\"Prerequisites\"><a href=\"#Prerequisites\" class=\"headerlink\" title=\"Prerequisites\"></a>Prerequisites</h2><ul>\n<li>You have access to the PC to run the server.</li>\n<li>You are comfortable using the terminal/command prompt.  </li>\n<li>You have admin access to your router/ISP so you can change firewall and port forwarding rules.</li>\n<li>The host machine is able to run Docker.  </li>\n<li>The host machine is able to run 24/7.  </li>\n</ul>\n<h2 id=\"Setup-Docker\"><a href=\"#Setup-Docker\" class=\"headerlink\" title=\"Setup Docker\"></a>Setup Docker</h2><p>Download and install <a href=\"https://www.docker.com/products/docker-desktop\">Docker Desktop</a> on the host machine. I installed it on macOS but same steps apply if you are using Windows or Linux. You may get prompted for a tutorial when starting Docker Desktop for the first time, feel free to complete it if you aren’t familiar with Docker.  </p>\n<p>Once installed, head to Docker’s preferences to change resources and restart policy. Make sure to check the checkbox “Start Docker Desktop when you log in”.    </p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/docker-restart-on-log-in.png\"></p>\n<p>Change the amount of memory, CPUs, and disk space Docker is allocated.  Any running Docker containers won’t exceed the amounts here. If the host machine is just running the Valheim server, I’d recommend to allocate all available memory and CPUs to maximize performance. The disk image size constraints how much storage Docker can use before it “runs out”; I set mine to around 50 GB.  After making changes, hit “Apply and Restart” for it to take effect.   </p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/change-docker-memory-cpus.png\"></p>\n<p>For next steps, we will be using Docker’s command line interface (CLI) called <code>docker</code>. The CLI is only available if Docker Desktop is running. To make sure it’s working, open a Terminal or Command Prompt and type in <code>docker ps</code>. You should see output similar to below.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker ps</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Run-Valheim-on-Docker\"><a href=\"#Run-Valheim-on-Docker\" class=\"headerlink\" title=\"Run Valheim on Docker\"></a>Run Valheim on Docker</h2><p>Now we need to download the Valheim server and somehow run it on Docker. Steam provides <a href=\"https://developer.valvesoftware.com/wiki/SteamCMD\">SteamCMD</a> which is a command-line interface of the Steam client. It can be used to programmatically download Steam games and servers. We will use it to download the Valheim server. Thankfully there is already an existing Docker image that comes with SteamCMD ready to use: <a href=\"https://hub.docker.com/r/cm2network/steamcmd\">cm2network/steamcmd</a>.  </p>\n<p>Download the Docker image:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker pull cm2network/steamcmd</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from cm2network/steamcmd</span><br><span class=\"line\">45b42c59be33: Pull complete </span><br><span class=\"line\">a4d9e5a1b4b0: Pull complete </span><br><span class=\"line\">Digest: sha256:0bd046d574a92bdd7a020beb9a8bc4ab8498d96422c005893316800d630a58c3</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> cm2network/steamcmd:latest</span><br><span class=\"line\">docker.io/cm2network/steamcmd:latest</span><br></pre></td></tr></table></figure>\n\n<p>Next let’s run the image in interactive mode to make sure it works and see how we could run a Valheim server.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker run -it --name=steamcmd cm2network/steamcmd</span><br><span class=\"line\">steam@cf87295af3ac:~/steamcmd$ </span><br></pre></td></tr></table></figure>\n\n<p>You should notice your command prompt has changed.  We are now in the running Docker container in interactive mode. Some things to note:</p>\n<ul>\n<li>The Docker container will stop running if you exit (e.g. CTRL+D)</li>\n<li>While the container is running, use <code>docker ps</code> to find its container ID (host machine terminal)</li>\n<li>The running container is named <code>steamcmd</code> (from <code>--name=steamcmd</code>).  </li>\n<li>The same container can be re-activated by using <code>docker start --interactive steamcmd</code></li>\n<li>To delete the named container, use <code>docker rm steamcmd</code>.  </li>\n</ul>\n<p>With SteamCMD, we can now install the Valheim server. We need its ID which happens to be <code>896660</code>. I found this information on steamdb.com: <a href=\"https://steamdb.info/app/896660/\">Valheim Server</a>.  </p>\n<p>Run the following command to install the Valheim server in the running Docker container:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./steamcmd.sh +login anonymous \\</span><br><span class=\"line\">+force_install_dir valheimserver/ \\</span><br><span class=\"line\">+app_update 896660 \\</span><br><span class=\"line\">validate +<span class=\"built_in\">exit</span> </span><br></pre></td></tr></table></figure>\n<p>After a minute you should see a message like “Success! App ‘896660’ fully installed.”</p>\n<p>In the current directory, there is now a <code>valheimserver/</code> folder:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">steam@cf87295af3ac:~/steamcmd$ ls valheimserver/</span><br><span class=\"line\"> LinuxPlayer_s.debug   UnityPlayer_s.debug                    linux64           start_server.sh         steam_appid.txt   steamclient.so          valheim_server_Data</span><br><span class=\"line\"> UnityPlayer.so       &#x27;Valheim Dedicated Server Manual.pdf&#x27;   server_exit.drp   start_server_xterm.sh   steamapps         valheim_server.x86_64</span><br></pre></td></tr></table></figure>\n<p>The server install includes a manual which I’ve also made available here: <a href=\"/misc/valheim-dedicated-server-manual.pdf\">Valheim Dedicated Server Manual</a> (disclaimer: the manual is subject to change so this link may become outdated). The manual explains how to run the Valheim server and its different configurable options.  Below is the command I used to copy the manual from the running Docker container. This command is run from the host machine’s terminal and not within the Docker container.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker cp steamcmd:/home/steam/steamcmd/valheimserver/<span class=\"string\">&#x27;Valheim Dedicated Server Manual.pdf&#x27;</span> ~/desktop</span><br></pre></td></tr></table></figure>\n<p>According to the manual, we should make a copy of <code>start_server.sh</code> and supply it with our parameters. The line to edit:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">./valheim_server.x86_64 -name &quot;My server&quot; -port 2456 -world &quot;Dedicated&quot; -password &quot;secret&quot;</span><br></pre></td></tr></table></figure>\n<p>The parameters (also explained in the manual):</p>\n<ul>\n<li><code>-name</code>: the name of the server that will appear in the server list</li>\n<li><code>-port</code>: the port the server will run on.  Keep the default as <code>2456</code>.  </li>\n<li><code>-world</code>: the name of the World that will be created, or the existing World to use.  </li>\n<li><code>-password</code>: the password to enter the server.  Must be at least 5 characters.  </li>\n<li><code>-savedir</code>: where the server loads and saves the World data (not in the example as it is optional)</li>\n</ul>\n<p>To create and edit a copy of <code>start_server.sh</code>:</p>\n<ul>\n<li>Copy with <code>cp start_server.sh example-start-server.sh</code> then edit with <code>nano</code> (while in the Docker container). </li>\n<li>Or, copy the file to the host machine, edit it there, and then copy it back to Docker<ul>\n<li>Copy file to host machine to desktop: <code>docker cp steamcmd:/home/steam/steamcmd/valheimserver/start_server.sh ~/desktop</code></li>\n<li>Edit and save as <code>example-start-server.sh</code>.  </li>\n<li>Copy back to the Docker container: <code>docker cp example-start-server.sh steamcmd:/home/steam/steamcmd/valheimserver</code></li>\n</ul>\n</li>\n</ul>\n<p>After editing this is what my <code>example-start-server.sh</code> looks like (I removed the comments):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> templdpath=<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LD_LIBRARY_PATH=./linux64:<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SteamAppId=892970</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Starting server PRESS CTRL-C to exit&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">./valheim_server.x86_64 -name <span class=\"string\">&quot;Example Server&quot;</span> -port 2456 -world <span class=\"string\">&quot;HelloWorld&quot;</span> -password <span class=\"string\">&quot;password123&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> LD_LIBRARY_PATH=<span class=\"variable\">$templdpath</span></span><br></pre></td></tr></table></figure>\n<p>Now run it by entering <code>./example-start-server.sh</code> in the Docker container. It should spit out a lot of different debug output. Of interest is it prints the world seed generated (since we did not use the <code>-savedir</code> parameter to an existing world).  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">02/13/2021 03:09:44: Initializing world generator seed:85nRPRACxA ( -1305926156 )   menu:False  worldgen version:1</span><br></pre></td></tr></table></figure>\n<p>We can also see where the generated world is stored by default (according to the manual):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">steam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/</span><br><span class=\"line\">adminlist.txt  bannedlist.txt  permittedlist.txt  prefs  worlds</span><br><span class=\"line\">steam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/worlds</span><br><span class=\"line\">HelloWorld.db  HelloWorld.fwl</span><br></pre></td></tr></table></figure>\n<p>Press CTRL+C to stop the server from running.   </p>\n<p>Congrats!  If you’ve got this far, it means you can now run a Valheim server on Docker!  There are a few more steps to consolidate what we’ve learned and then we have to open ports before your dedicated at home server is ready.</p>\n<h2 id=\"Create-a-Docker-image\"><a href=\"#Create-a-Docker-image\" class=\"headerlink\" title=\"Create a Docker image\"></a>Create a Docker image</h2><p>We did a bit of work in the previous steps and it’d be nice to avoid having to repeat it. Luckily, Docker provides <a href=\"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/\">Dockerfiles</a>, which can be used to build new Docker images from existing Docker images. Our goal here is to make a new Docker image that automatically starts the Valheim server without having to enter the container and manually enter commands as we did before. The Valheim server also needs to be shutdown gracefully so that current world data is properly saved whenever the container is stopped or restarted.  </p>\n<p>The Valheim server Docker image should be as generic as possible while allowing a user to customize server specific behavior at runtime (e.g. which world to use, what the password is, etc.). The strategy to do this is to separate the environment and installation setup from the actual command to start the server. This means we will write a custom script to start the Valheim server that controls how the server is started and shutdown. The Valheim server also needs to persist the worlds data into the host machine (as the containers are meant to be ephemeral). Persistence is accomplished by <a href=\"https://docs.docker.com/storage/bind-mounts/\">binding a directory from the host machine to a Docker volume</a> (this is also how we can add existing worlds to the server).  </p>\n<p>Given all that, here is our Dockerfile to build the Valheim server image:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> cm2network/steamcmd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># where the Valheim server is installed to</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_SERVER_DIR <span class=\"string\">&quot;/home/steam/valheim-server&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># install the Valheim server</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> ./steamcmd.sh +login anonymous \\</span></span><br><span class=\"line\"><span class=\"bash\">+force_install_dir <span class=\"variable\">$VALHEIM_SERVER_DIR</span> \\</span></span><br><span class=\"line\"><span class=\"bash\">+app_update 896660 \\</span></span><br><span class=\"line\"><span class=\"bash\">validate +<span class=\"built_in\">exit</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># where world data is stored, map this to the host directory where your worlds are stored</span></span><br><span class=\"line\"><span class=\"comment\"># e.g. docker run -v /path/to/host/directory:/home/steam/valheim-data</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_DATA_DIR <span class=\"string\">&quot;/home/steam/valheim-data&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># don&#x27;t change the port unless you know what you are doing</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_PORT <span class=\"number\">2456</span></span><br><span class=\"line\"><span class=\"comment\"># server and world name are truncated after 1st white space</span></span><br><span class=\"line\"><span class=\"comment\"># you must set values to the server and world name otherwise the container will exit immediately</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_SERVER_NAME=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_WORLD_NAME=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_PASSWORD <span class=\"string\">&quot;password&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># the server needs these 3 ports exposed by default</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">2456</span>/udp</span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">2457</span>/udp</span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">2458</span>/udp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"bash\"> <span class=\"variable\">$&#123;VALHEIM_DATA_DIR&#125;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># copy over the modified server start script</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> start-valheim-server.sh <span class=\"variable\">$&#123;VALHEIM_SERVER_DIR&#125;</span></span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> <span class=\"variable\">$&#123;VALHEIM_SERVER_DIR&#125;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># start the server!</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"bash\"> [<span class=\"string\">&quot;./start-valheim-server.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<p>I added comments to explain each part of this new Dockerfile for building a Valheim server image. Of note is that behavior is customized by passing in different values for the environment variables, e.g. one could change the world name by passing in <code>--env VALHEIM_WORLD_NAME=&quot;AWholeNewWorld&quot;</code> when executing <code>docker run</code>.  </p>\n<p>What does our <code>start-valheim-server.sh</code> look like?  Below is what I’ve come up with:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker sends a SIGTERM and then SIGKILL to the main process</span></span><br><span class=\"line\"><span class=\"comment\"># Valheim needs a SIGINT (CTRL+C) to terminate properly</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> shutdownValheimGracefully()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim server PID is: <span class=\"variable\">$1</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># send a SIGINT to shut down the Valheim server gracefully</span></span><br><span class=\"line\">    <span class=\"built_in\">kill</span> -2 <span class=\"variable\">$1</span></span><br><span class=\"line\">    <span class=\"comment\"># wait for Valheim to terminate before shutting down the container</span></span><br><span class=\"line\">    <span class=\"built_in\">wait</span> <span class=\"variable\">$1</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># catch Docker&#x27;s SIGTERM, then then a SIGINT to the Valheim server process</span></span><br><span class=\"line\"><span class=\"built_in\">trap</span> <span class=\"string\">&#x27;shutdownValheimGracefully &quot;$VALHEIM_PID&quot;&#x27;</span> SIGTERM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> templdpath=<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LD_LIBRARY_PATH=./linux64:<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SteamAppId=892970</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Starting server PRESS CTRL-C to exit&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;LD_LIBRARY_PATH: <span class=\"variable\">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim port is: <span class=\"variable\">$VALHEIM_PORT</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim server name is: <span class=\"variable\">$VALHEIM_SERVER_NAME</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim world name is: <span class=\"variable\">$VALHEIM_WORLD_NAME</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$VALHEIM_SERVER_DIR</span></span><br><span class=\"line\"><span class=\"comment\"># start the server as a background process to get its PID (&quot;&amp;&quot; at end of command)</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;&amp;&gt;&gt;&quot; means append all stdout and stderr to the log file</span></span><br><span class=\"line\">./valheim_server.x86_64 -name <span class=\"variable\">$VALHEIM_SERVER_NAME</span> \\</span><br><span class=\"line\">-port <span class=\"variable\">$VALHEIM_PORT</span> \\</span><br><span class=\"line\">-world <span class=\"variable\">$VALHEIM_WORLD_NAME</span> \\</span><br><span class=\"line\">-password <span class=\"variable\">$VALHEIM_PASSWORD</span> \\</span><br><span class=\"line\">-savedir <span class=\"variable\">$VALHEIM_DATA_DIR</span> &amp;&gt;&gt; /home/steam/valheim-data/valheim-logs.txt &amp;</span><br><span class=\"line\">VALHEIM_PID=$!</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim server PID is: <span class=\"variable\">$VALHEIM_PID</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># since the server is run in the background, this is needed to keep the main process from exiting</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">wait</span> $!; [ $? != 0 ]; <span class=\"keyword\">do</span> <span class=\"literal\">true</span>; <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<p>This script is mostly a copy of the original <code>start_server.sh</code> script that comes with Valheim server installation.  I’ve added comments to explain some of the changes made to accommodate running the server in Docker. Most importantly is providing a graceful shutdown to the running Valheim server, which needs a <code>SIGINT</code> signal to properly terminate (equivalent to hitting CTRL+C when running the server manually). Docker sends a <code>SIGTERM</code> signal by default. This script traps the <code>SIGTERM</code> signal, and then sends a <code>SIGINT</code> signal to the Valheim server process (the <code>kill -2</code> command) before exiting properly.  Without this behavior, the server would not terminate properly and thus world data would not be saved completely. For more background on why this is necessary, see this wonderful article: <a href=\"https://www.ctl.io/developers/blog/post/gracefully-stopping-docker-containers/\">Gracefully Stopping Docker Containers</a>.  </p>\n<p>To build our image, create a new directory on the host machine and create two files in it called <code>Dockerfile</code> and <code>start-valheim-server.sh</code>. <code>Dockerfile</code> should be exactly the contents of the Dockerfile I provided above, and likewise for the custom start script. Note the file to build the Docker image <strong>must</strong> be named <code>Dockerfile</code>. On the host terminal, enter the directory and build the new image using <a href=\"https://docs.docker.com/engine/reference/commandline/build/\">docker build</a>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine docker % <span class=\"built_in\">pwd</span></span><br><span class=\"line\">/home/sethmachine/valheim/docker</span><br><span class=\"line\">sethmachine docker % ls</span><br><span class=\"line\">Dockerfile              start-valheim-server.sh</span><br><span class=\"line\">sethmachine docker % docker build -t sethmachine/valheim-server .</span><br><span class=\"line\">[+] Building 0.2s (10/10) FINISHED                                                                                                                                          </span><br><span class=\"line\"> =&gt; [internal] load build definition from Dockerfile                                                                                                                   0.0s</span><br><span class=\"line\"> =&gt; =&gt; transferring dockerfile: 1.15kB                                                                                                                                 0.0s</span><br><span class=\"line\"> =&gt; [internal] load .dockerignore                                                                                                                                      0.0s</span><br><span class=\"line\"> =&gt; =&gt; transferring context: 2B                                                                                                                                        0.0s</span><br><span class=\"line\"> =&gt; [internal] load metadata <span class=\"keyword\">for</span> docker.io/cm2network/steamcmd:latest                                                                                                  0.0s</span><br><span class=\"line\"> =&gt; [1/5] FROM docker.io/cm2network/steamcmd                                                                                                                           0.0s</span><br><span class=\"line\"> =&gt; [internal] load build context                                                                                                                                      0.0s</span><br><span class=\"line\"> =&gt; =&gt; transferring context: 1.03kB                                                                                                                                    0.0s</span><br><span class=\"line\"> =&gt; CACHED [2/5] RUN ./steamcmd.sh +login anonymous +force_install_dir /home/steam/valheim-server +app_update 896660 validate +<span class=\"built_in\">exit</span>                                    0.0s</span><br><span class=\"line\"> =&gt; CACHED [3/5] RUN apt-get update &amp;&amp; apt-get install -y procps                                                                                                       0.0s</span><br><span class=\"line\"> =&gt; [4/5] COPY start-valheim-server.sh /home/steam/valheim-server                                                                                                      0.0s</span><br><span class=\"line\"> =&gt; [5/5] WORKDIR /home/steam/valheim-server                                                                                                                           0.0s</span><br><span class=\"line\"> =&gt; exporting to image                                                                                                                                                 0.0s</span><br><span class=\"line\"> =&gt; =&gt; exporting layers                                                                                                                                                0.0s</span><br><span class=\"line\"> =&gt; =&gt; writing image sha256:da020f90db05f93dfbcd9f0a2489cb5bcaa6baf9ac2bf9a84a37511c47384972                                                                           0.0s</span><br><span class=\"line\"> =&gt; =&gt; naming to docker.io/sethmachine/valheim-server                                                                                                                   0.0s </span><br></pre></td></tr></table></figure>\n<p><em>Note that rebuilding the image will re-use previous layers, including the version of the Valheim server downloaded.  This is both good and bad.  Good because it makes re-building the image very quick.  But it is bad if Valheim has updated the server and Docker’s cache has gone stale.  In that case, add the <code>--no-cache</code> argument when rebuilding if Valheim has been updated.</em></p>\n<p>The new image should now show up when running <code>docker image ls</code>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker image ls | grep <span class=\"string\">&quot;valheim&quot;</span></span><br><span class=\"line\">sethmachine/valheim-server   latest    da020f90db05   5 minutes ago       1.71GB</span><br></pre></td></tr></table></figure>\n<p>Congrats, we have built a Valheim server Docker image!  Now we need to run it as a container.    </p>\n<h2 id=\"Run-the-valheim-server-image\"><a href=\"#Run-the-valheim-server-image\" class=\"headerlink\" title=\"Run the valheim-server image\"></a>Run the valheim-server image</h2><p>To run the Valheim server image, we need to decide where Valheim’s worlds data will be stored on the host machine, and then pass in parameters to decide the name, password, and world of the server.  </p>\n<p>The image volume <code>/home/steam/valheim-data</code> needs to be bound to a directory on the host machine where all worlds data is persisted. The host machine directory should be empty or contain a subdirectory called <code>worlds</code> which can contain already created Valheim worlds. When the Valheim server runs, if the world does not exist in the host directory, then it will be created anew. If the world already does exist (i.e. there are files in the <code>worlds</code> subdirectory with the name of the world), then the server will use it as the server’s world rather than making a new one. </p>\n<p>On my host machine, I have a directory at <code>/home/sethmachine/valeim-data</code> which I will map onto the image’s volume.  Here is what it looks like before I run the Valhem server and make a new world:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % tree /home/sethmachine/valeim-data</span><br><span class=\"line\">/home/sethmachine/valeim-data</span><br><span class=\"line\">└── worlds</span><br><span class=\"line\">    ├── OldWorld.db</span><br><span class=\"line\">    └── OldWorld.fwl</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 2 files</span><br></pre></td></tr></table></figure>\n<p>(<a href=\"https://en.wikipedia.org/wiki/Tree_(command)\">tree</a> is a helpful command to visualize a directory)</p>\n<p>This folder already has an existing world that I copied over, <code>OldWorld</code>, but your folder can be completely empty.  </p>\n<p>There are 3 parameters to set when running the server.  The server name and world name <strong>must</strong> be provided at runtime, otherwise the container will exit immediately.  </p>\n<ul>\n<li><code>VALHEIM_SERVER_NAME</code>: the name that will appear in Valheim’s server list, truncated at first whitespace</li>\n<li><code>VALHEIM_WORLD_NAME</code>: the name of the Valheim world (can be an existing world), truncated at first whitespace</li>\n<li><code>VALHEIM_PASSWORD</code>: the password to join the server (can be set to empty for no password, default is “password”)</li>\n</ul>\n<p>Below is an example command that runs a Valheim server with the host directory set to <code>/home/sethmachine/valeim-data</code>.  Note this container is named <code>valheim</code> to make it easier to reference with Docker commands.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --name=valheim -d \\</span><br><span class=\"line\">-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\</span><br><span class=\"line\">-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\</span><br><span class=\"line\">--env VALHEIM_SERVER_NAME=<span class=\"string\">&quot;sethmachine&#x27;sServer&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_WORLD_NAME=<span class=\"string\">&quot;AWholeNewWorld&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_PASSWORD=<span class=\"string\">&quot;HardToGuessPassword&quot;</span> \\</span><br><span class=\"line\">sethmachine/valheim-server</span><br></pre></td></tr></table></figure>\n<p>Explanation:</p>\n<ul>\n<li><code>docker run</code>: creates a running container from an image, in this case the image is <code>sethmachine/valheim-server</code></li>\n<li><code>-d</code>: runs the container in the background</li>\n<li><code>-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp</code>: exposes and maps ports 2456, 2457, 2458 on the host to the container </li>\n<li><code>--env VALHEIM_SERVER_NAME=&quot;sethmachine&#39;sServer&quot;</code>: sets the server’s name</li>\n<li><code>--env VALHEIM_WORLD_NAME=&quot;AWholeNewWorld&quot;</code>: sets the world’s name</li>\n<li><code>--env VALHEIM_PASSWORD=&quot;HardToGuessPassword&quot;</code>: sets the server’s password</li>\n</ul>\n<p>Use <code>docker container ls</code> to confirm the server is running:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % docker container ls</span><br><span class=\"line\">CONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS           NAMES</span><br><span class=\"line\">db70c7b20af7   sethmachine/valheim-server   <span class=\"string\">&quot;./start-valheim-ser…&quot;</span>   10 minutes ago   Up 10 minutes   2456-2458/udp   valheim</span><br></pre></td></tr></table></figure>\n<p>Use <code>docker logs valheim</code> to get output information about the server:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % docker logs valheim</span><br><span class=\"line\">Starting server PRESS CTRL-C to <span class=\"built_in\">exit</span></span><br><span class=\"line\">LD_LIBRARY_PATH: ./linux64:</span><br><span class=\"line\">Valheim port is: 2456</span><br><span class=\"line\">Valheim server name is: sethmachine<span class=\"string\">&#x27;sServer</span></span><br><span class=\"line\"><span class=\"string\">Valheim world name is: AWholeNewWorld</span></span><br><span class=\"line\"><span class=\"string\">Valheim server PID is: 7</span></span><br></pre></td></tr></table></figure>\n<p>Under the mounted host directory (mine is <code>/home/sethmachine/valeim-data</code>), there should be several files and a “worlds” subdirectory:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % tree /home/sethmachine/valeim-data</span><br><span class=\"line\">/home/sethmachine/valeim-data</span><br><span class=\"line\">├── AWholeNewWorld-logs.txt</span><br><span class=\"line\">├── adminlist.txt</span><br><span class=\"line\">├── bannedlist.txt</span><br><span class=\"line\">├── permittedlist.txt</span><br><span class=\"line\">└── worlds</span><br><span class=\"line\">    ├── AWholeNewWorld.fwl</span><br><span class=\"line\">    ├── OldWorld.db</span><br><span class=\"line\">    └── OldWorld.fwl</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 7 files</span><br></pre></td></tr></table></figure>\n<p>What each of these files mean:</p>\n<ul>\n<li><code>AWholeNewWorld-logs.txt</code>: this is a Valheim specific log file for the world we created</li>\n<li><code>adminlist.txt</code>: determines who is an admin (add Steam ID, one per line)</li>\n<li><code>bannedlist.txt</code>: automatically bans players (add Steam ID, one per line)</li>\n<li><code>permittedlist.txt</code>: whitelist for who can join (add Steam ID, one per line).  Note if this has a single Steam ID in it, this will ban everyone else from the server besides players whose Steam ID is in this list.</li>\n<li><code>worlds</code>: directory where Valheim worlds data is stored (including old or already existing worlds)</li>\n</ul>\n<p>If you’ve seen similar output on your end, then congrats, you are able to run the Valheim server Docker image!</p>\n<p>To stop the server, use <code>docker stop valheim</code>.  This will create a new database (<code>.db</code>) file for the world as well:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % docker stop valheim</span><br><span class=\"line\">valheim</span><br><span class=\"line\">sethmachine valheim-server-docker % tree /home/sethmachine/valeim-data</span><br><span class=\"line\">/home/sethmachine/valeim-data</span><br><span class=\"line\">├── AWholeNewWorld-logs.txt</span><br><span class=\"line\">├── adminlist.txt</span><br><span class=\"line\">├── bannedlist.txt</span><br><span class=\"line\">├── permittedlist.txt</span><br><span class=\"line\">└── worlds</span><br><span class=\"line\">    ├── AWholeNewWorld.db</span><br><span class=\"line\">    ├── AWholeNewWorld.fwl</span><br><span class=\"line\">    ├── OldWorld.db</span><br><span class=\"line\">    └── OldWorld.fwl</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 8 files</span><br></pre></td></tr></table></figure>\n<p>Note the new <code>AWholeNewWorld.db</code> file.  This contains the save data of the world; because it has been created, we know the Valheim server shut down properly.   </p>\n<p>For the server to be up almost 24/7 we will want it to restart automatically whenever it is turned off (e.g. the host machine restarts or the Docker container somehow crashes, is killed, etc.).  To do this, we specify a <a href=\"https://docs.docker.com/config/containers/start-containers-automatically/\">restart policy</a> when running the container.  The <code>always</code> policy appears appropriate, as it means the server will automatically run whenever Docker restarts.  Only manually stopping the server with <code>docker stop</code> will prevent it from automatically restarting.  Finally, this gives us a suitable command to begin running our server indefinitely!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --name=valheim -d \\</span><br><span class=\"line\">--restart always \\</span><br><span class=\"line\">-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\</span><br><span class=\"line\">-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\</span><br><span class=\"line\">--env VALHEIM_SERVER_NAME=<span class=\"string\">&quot;sethmachine&#x27;sServer&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_WORLD_NAME=<span class=\"string\">&quot;AWholeNewWorld&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_PASSWORD=<span class=\"string\">&quot;HardToGuessPassword&quot;</span> \\</span><br><span class=\"line\">sethmachine/valheim-server</span><br></pre></td></tr></table></figure>\n<p>With <code>--restart always</code> and Docker Desktop set to restart on log in, our server should be up and running all the time once we execute the above command.  Note you can still use <code>docker stop valheim</code> followed by <code>docker rm valheim</code> to stop the server completely (e.g. you want to run a different world or take a break).</p>\n<h2 id=\"Port-Forwarding\"><a href=\"#Port-Forwarding\" class=\"headerlink\" title=\"Port Forwarding\"></a>Port Forwarding</h2><p><em>This step is highly dependent upon your internet service provider and firewall settings of the host machine.  You will likely need to do additional research to open the ports on your host machine</em></p>\n<p>Hosting a dedicated server requires allowing incoming connections from the ports the Valheim server uses.  These ports are 2456, 2457, and 2458 (UDP protocol).  Without these ports open, your server will not be visible and your friends cannot play with you.  </p>\n<p>In general you will need to follow these steps:</p>\n<ul>\n<li>Disable any firewall software on your host machine.  If you know how to modify your firewall just for the Valheim ports, feel free to do so instead.  </li>\n<li>Find your router’s IP address and then log in to it, e.g. see <a href=\"https://www.highspeedinternet.com/resources/how-to-log-in-to-your-router\">How to Log In to Your Router</a>  </li>\n<li>In the router admin controls, find where to add port forwarding rules.</li>\n</ul>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/router-port-forwarding-location.png\"></p>\n<ul>\n<li>Find the LAN IP address of the host machine, e.g. see: <a href=\"https://uca.edu/it/knowledgebase-legacy/finding-your-ip-address-lan/\">Find your LAN IP address</a>.  The LAN IP is the IP assigned to the host machine within your local/home network.  </li>\n<li>Create 3 new port forwarding rules for the host machine’s LAN IP that allow any traffic to 2456, 2457, and 2458, all for UDP. </li>\n</ul>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/show-forwarded-ports-2456-2457-2458.png\"></p>\n<p>We can use external tools and websites to see if the ports were opened correctly.  </p>\n<ul>\n<li>Turn on the Valheim server if it is not already running.     </li>\n<li>First, find your public IP address.  Head to <a href=\"https://www.whatismyip.com/\">whatsmyip.com</a> and keep a note of the IP v4 address.  Note most home ISPs use dynamic IPs, so at some point your IP will change and you will have to update any configurations based on the your public IP.  </li>\n<li>Head to <a href=\"https://check-host.net/\">check-host.net</a> and put in your public IP address followed by a colon and then the port number.  We will test each port (2456, 2457, 2458) individually.  Then hit the “UDP port” button.  If your ports are open you should see similar results to mine below.  If you see “Open or Filtered” it means it’s working.  If you see “Connection Refused”, re-check your port forwarding settings and make sure the Valheim server is running.  </li>\n</ul>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/show-check-host-ports-open.png\"></p>\n<h2 id=\"Access-your-server-on-Steam\"><a href=\"#Access-your-server-on-Steam\" class=\"headerlink\" title=\"Access your server on Steam\"></a>Access your server on Steam</h2><p>With the server running and the proper ports exposed, we can finally use the server on Steam!  </p>\n<p>Head to your Steam client and access servers from the view menu:</p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/steam-view-servers-menu.png\"></p>\n<p>This will open a new window to manage servers.  Select the “Favorites” tab and then “Add a server”.  Enter your IPv4 address followed by port <code>2457</code>, then add the server:</p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/steam-add-server.png\"></p>\n<p>If it works, you’ll see your server listed like mine:</p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/steam-server-listed.png\"></p>\n<p>If you do not see anything, trying hitting the refresh button.  If your server is listed as offline or unable to connect, re-visit the previous steps. Make sure your server is actually running.  Make sure ports 2456, 2457, and 2458 are exposed.  </p>\n<p>Finally, we can actually join the server in Valheim!  </p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/valeheim-see-server.png\"></p>\n<h2 id=\"Final-thoughts\"><a href=\"#Final-thoughts\" class=\"headerlink\" title=\"Final thoughts\"></a>Final thoughts</h2><p>We were able to successfully run the Valheim server on a Docker container, and allow it to be accessible so others can join!  We created a custom start script so the server would shut down properly and save world data.</p>\n<p>I’ve made a Docker image available on Docker Hub and the corresponding Dockerfile and script on GitHub:</p>\n<ul>\n<li>Docker Hub: <a href=\"https://hub.docker.com/r/sethmachineio/valheim-server\">sethmachineio/valheim-server</a></li>\n<li>GitHub: <a href=\"https://github.com/sethmachine/valheim-server-docker\">valheim-server-docker</a></li>\n</ul>\n<p>Feel free to leave a comment if you found this helpful, have any feedback, or are stuck on any parts of this guide.  I’ll do my best to respond and help you!  </p>\n<h3 id=\"Follow-up-tasks\"><a href=\"#Follow-up-tasks\" class=\"headerlink\" title=\"Follow up tasks\"></a>Follow up tasks</h3><p>There a few improvements we can make to make the Valheim server easier to use.  I will address these in a separate follow-up guide.  </p>\n<ul>\n<li>Automatically updating the server software without rebuilding the Docker image.  When Valheim provides updates to its game client, players on the newer client cannot join servers running on older versions of Valheim.  Right now to fix this requires stopping the server and building a new image using the <code>--no-cache</code> option.  As a follow-up we should modify the running container to automatically update itself whenever Valheim is updated.  </li>\n<li>Create backups of worlds periodically.  If anything should happen to the worlds save file (corrupted, accidentally deleted, someone griefs the server), it would be nice to have backups to revert to.  </li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p><img src=\"/2021/02/10/host-valheim-with-docker/valheim-dedicated-server-logo.jpg\" alt=\"Valheim Dedicated Server with Docker\"></p>\n<p>This guide explains how to host a dedicated Valheim server with Docker that can be run at home while still being publicly accessible over the internet so your friends can join anytime.  Ideally the server is hosted on a spare computer, but it can still run on the same computer you play on.   </p>\n<p>For those unfamiliar, <a href=\"https://store.steampowered.com/app/892970/Valheim/\">Valheim</a> is a builder-survival that is akin to Minecraft but much darker and focused on a Viking theme, which has gone viral with over 1 million purchases in its first weeks. Now is a better time than ever to start playing!</p>\n<p>If you’ve worked with Docker before and know what you’re doing, feel free to jump straight to using the image I built:</p>\n<ul>\n<li>Docker Hub: <a href=\"https://hub.docker.com/r/sethmachineio/valheim-server\">sethmachineio/valheim-server</a></li>\n<li>GitHub: <a href=\"https://github.com/sethmachine/valheim-server-docker\">valheim-server-docker</a></li>\n</ul>\n<h2 id=\"Why-host-your-own\"><a href=\"#Why-host-your-own\" class=\"headerlink\" title=\"Why host your own?\"></a>Why host your own?</h2><p>Valheim does have “peer-to-peer” hosting. But if the host logs off, then the world is no longer accessible to anyone and everyone else gets removed from the world. Hosting a dedicated Valheim server solves this by being accessible 24/7, so your friends can play even if you’re not online. This makes the experience all the more immersive.  </p>\n<p>Hosting at home also means a lot of cost savings. It’s already possible to rent a dedicated Valheim server for around <a href=\"https://www.g-portal.com/us/en/gameserver/valheim-server-hosting?gclid=CjwKCAiA65iBBhB-EiwAW253Wwfyd6STzTQV4yvvwD_GBJHvuZDQkZNDuSTUMHexNYkIT_Z0zVPSDhoCzUkQAvD_BwE\">$12/month</a>. However, I estimate my 2013 iMac would only cost around $7/month to run 24/7 (assuming the monitor is completely turned off). See: <a href=\"https://support.apple.com/en-us/HT201918\">iMac energy consumption</a> and <a href=\"https://energyusecalculator.com/electricity_computer.htm#:~:text=We%20estimate%20that%20an%20average,not%20including%20the%20display%20screen.\">Electricity usage of a Computer calculator</a>.  I used 100 watts as an estimate. That is a cost savings of over 40%!</p>\n<p>In summary:</p>\n<ul>\n<li>You want a dedicated server running 24/7.</li>\n<li>You want to save over 40% compared to renting a dedicated server (or buying compute from AWS/Google Cloud, etc.).</li>\n<li>You want to have fun on a mini project and learn about Docker/hosting.</li>\n</ul>\n<h2 id=\"About-Docker\"><a href=\"#About-Docker\" class=\"headerlink\" title=\"About Docker\"></a>About Docker</h2><p><a href=\"https://www.docker.com/why-docker\">Docker</a> allows for a repeatable and configurable process to manage running the Valheim server. Meaning if we ever need to update the server, we simply rebuild it in a single command with Docker. As a Docker container, the server can be run on any computer that also runs Docker. This means it’s easy to move the server to another computer if needed (e.g. more resources such as memory). Further, we can take advantage of Docker’s automatic restart policies, so the server will automatically turn back on if the host machine restarts.</p>\n<p>If you want to host on macOS, Docker is absolute requirement, as Valheim is only supported on Windows and Linux.  Using the steps in this guide I have been able to host my Valheim server on my 2013 iMac.  Note that playing the actual game must be done on Windows or Linux.     </p>\n<h2 id=\"Prerequisites\"><a href=\"#Prerequisites\" class=\"headerlink\" title=\"Prerequisites\"></a>Prerequisites</h2><ul>\n<li>You have access to the PC to run the server.</li>\n<li>You are comfortable using the terminal/command prompt.  </li>\n<li>You have admin access to your router/ISP so you can change firewall and port forwarding rules.</li>\n<li>The host machine is able to run Docker.  </li>\n<li>The host machine is able to run 24/7.  </li>\n</ul>\n<h2 id=\"Setup-Docker\"><a href=\"#Setup-Docker\" class=\"headerlink\" title=\"Setup Docker\"></a>Setup Docker</h2><p>Download and install <a href=\"https://www.docker.com/products/docker-desktop\">Docker Desktop</a> on the host machine. I installed it on macOS but same steps apply if you are using Windows or Linux. You may get prompted for a tutorial when starting Docker Desktop for the first time, feel free to complete it if you aren’t familiar with Docker.  </p>\n<p>Once installed, head to Docker’s preferences to change resources and restart policy. Make sure to check the checkbox “Start Docker Desktop when you log in”.    </p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/docker-restart-on-log-in.png\"></p>\n<p>Change the amount of memory, CPUs, and disk space Docker is allocated.  Any running Docker containers won’t exceed the amounts here. If the host machine is just running the Valheim server, I’d recommend to allocate all available memory and CPUs to maximize performance. The disk image size constraints how much storage Docker can use before it “runs out”; I set mine to around 50 GB.  After making changes, hit “Apply and Restart” for it to take effect.   </p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/change-docker-memory-cpus.png\"></p>\n<p>For next steps, we will be using Docker’s command line interface (CLI) called <code>docker</code>. The CLI is only available if Docker Desktop is running. To make sure it’s working, open a Terminal or Command Prompt and type in <code>docker ps</code>. You should see output similar to below.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker ps</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Run-Valheim-on-Docker\"><a href=\"#Run-Valheim-on-Docker\" class=\"headerlink\" title=\"Run Valheim on Docker\"></a>Run Valheim on Docker</h2><p>Now we need to download the Valheim server and somehow run it on Docker. Steam provides <a href=\"https://developer.valvesoftware.com/wiki/SteamCMD\">SteamCMD</a> which is a command-line interface of the Steam client. It can be used to programmatically download Steam games and servers. We will use it to download the Valheim server. Thankfully there is already an existing Docker image that comes with SteamCMD ready to use: <a href=\"https://hub.docker.com/r/cm2network/steamcmd\">cm2network/steamcmd</a>.  </p>\n<p>Download the Docker image:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker pull cm2network/steamcmd</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from cm2network/steamcmd</span><br><span class=\"line\">45b42c59be33: Pull complete </span><br><span class=\"line\">a4d9e5a1b4b0: Pull complete </span><br><span class=\"line\">Digest: sha256:0bd046d574a92bdd7a020beb9a8bc4ab8498d96422c005893316800d630a58c3</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> cm2network/steamcmd:latest</span><br><span class=\"line\">docker.io/cm2network/steamcmd:latest</span><br></pre></td></tr></table></figure>\n\n<p>Next let’s run the image in interactive mode to make sure it works and see how we could run a Valheim server.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker run -it --name=steamcmd cm2network/steamcmd</span><br><span class=\"line\">steam@cf87295af3ac:~/steamcmd$ </span><br></pre></td></tr></table></figure>\n\n<p>You should notice your command prompt has changed.  We are now in the running Docker container in interactive mode. Some things to note:</p>\n<ul>\n<li>The Docker container will stop running if you exit (e.g. CTRL+D)</li>\n<li>While the container is running, use <code>docker ps</code> to find its container ID (host machine terminal)</li>\n<li>The running container is named <code>steamcmd</code> (from <code>--name=steamcmd</code>).  </li>\n<li>The same container can be re-activated by using <code>docker start --interactive steamcmd</code></li>\n<li>To delete the named container, use <code>docker rm steamcmd</code>.  </li>\n</ul>\n<p>With SteamCMD, we can now install the Valheim server. We need its ID which happens to be <code>896660</code>. I found this information on steamdb.com: <a href=\"https://steamdb.info/app/896660/\">Valheim Server</a>.  </p>\n<p>Run the following command to install the Valheim server in the running Docker container:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./steamcmd.sh +login anonymous \\</span><br><span class=\"line\">+force_install_dir valheimserver/ \\</span><br><span class=\"line\">+app_update 896660 \\</span><br><span class=\"line\">validate +<span class=\"built_in\">exit</span> </span><br></pre></td></tr></table></figure>\n<p>After a minute you should see a message like “Success! App ‘896660’ fully installed.”</p>\n<p>In the current directory, there is now a <code>valheimserver/</code> folder:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">steam@cf87295af3ac:~/steamcmd$ ls valheimserver/</span><br><span class=\"line\"> LinuxPlayer_s.debug   UnityPlayer_s.debug                    linux64           start_server.sh         steam_appid.txt   steamclient.so          valheim_server_Data</span><br><span class=\"line\"> UnityPlayer.so       &#x27;Valheim Dedicated Server Manual.pdf&#x27;   server_exit.drp   start_server_xterm.sh   steamapps         valheim_server.x86_64</span><br></pre></td></tr></table></figure>\n<p>The server install includes a manual which I’ve also made available here: <a href=\"/misc/valheim-dedicated-server-manual.pdf\">Valheim Dedicated Server Manual</a> (disclaimer: the manual is subject to change so this link may become outdated). The manual explains how to run the Valheim server and its different configurable options.  Below is the command I used to copy the manual from the running Docker container. This command is run from the host machine’s terminal and not within the Docker container.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker cp steamcmd:/home/steam/steamcmd/valheimserver/<span class=\"string\">&#x27;Valheim Dedicated Server Manual.pdf&#x27;</span> ~/desktop</span><br></pre></td></tr></table></figure>\n<p>According to the manual, we should make a copy of <code>start_server.sh</code> and supply it with our parameters. The line to edit:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">./valheim_server.x86_64 -name &quot;My server&quot; -port 2456 -world &quot;Dedicated&quot; -password &quot;secret&quot;</span><br></pre></td></tr></table></figure>\n<p>The parameters (also explained in the manual):</p>\n<ul>\n<li><code>-name</code>: the name of the server that will appear in the server list</li>\n<li><code>-port</code>: the port the server will run on.  Keep the default as <code>2456</code>.  </li>\n<li><code>-world</code>: the name of the World that will be created, or the existing World to use.  </li>\n<li><code>-password</code>: the password to enter the server.  Must be at least 5 characters.  </li>\n<li><code>-savedir</code>: where the server loads and saves the World data (not in the example as it is optional)</li>\n</ul>\n<p>To create and edit a copy of <code>start_server.sh</code>:</p>\n<ul>\n<li>Copy with <code>cp start_server.sh example-start-server.sh</code> then edit with <code>nano</code> (while in the Docker container). </li>\n<li>Or, copy the file to the host machine, edit it there, and then copy it back to Docker<ul>\n<li>Copy file to host machine to desktop: <code>docker cp steamcmd:/home/steam/steamcmd/valheimserver/start_server.sh ~/desktop</code></li>\n<li>Edit and save as <code>example-start-server.sh</code>.  </li>\n<li>Copy back to the Docker container: <code>docker cp example-start-server.sh steamcmd:/home/steam/steamcmd/valheimserver</code></li>\n</ul>\n</li>\n</ul>\n<p>After editing this is what my <code>example-start-server.sh</code> looks like (I removed the comments):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> templdpath=<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LD_LIBRARY_PATH=./linux64:<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SteamAppId=892970</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Starting server PRESS CTRL-C to exit&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">./valheim_server.x86_64 -name <span class=\"string\">&quot;Example Server&quot;</span> -port 2456 -world <span class=\"string\">&quot;HelloWorld&quot;</span> -password <span class=\"string\">&quot;password123&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> LD_LIBRARY_PATH=<span class=\"variable\">$templdpath</span></span><br></pre></td></tr></table></figure>\n<p>Now run it by entering <code>./example-start-server.sh</code> in the Docker container. It should spit out a lot of different debug output. Of interest is it prints the world seed generated (since we did not use the <code>-savedir</code> parameter to an existing world).  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">02/13/2021 03:09:44: Initializing world generator seed:85nRPRACxA ( -1305926156 )   menu:False  worldgen version:1</span><br></pre></td></tr></table></figure>\n<p>We can also see where the generated world is stored by default (according to the manual):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">steam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/</span><br><span class=\"line\">adminlist.txt  bannedlist.txt  permittedlist.txt  prefs  worlds</span><br><span class=\"line\">steam@109e3304d5f3:~/steamcmd/valheimserver$ ls ~/.config/unity3d/IronGate/Valheim/worlds</span><br><span class=\"line\">HelloWorld.db  HelloWorld.fwl</span><br></pre></td></tr></table></figure>\n<p>Press CTRL+C to stop the server from running.   </p>\n<p>Congrats!  If you’ve got this far, it means you can now run a Valheim server on Docker!  There are a few more steps to consolidate what we’ve learned and then we have to open ports before your dedicated at home server is ready.</p>\n<h2 id=\"Create-a-Docker-image\"><a href=\"#Create-a-Docker-image\" class=\"headerlink\" title=\"Create a Docker image\"></a>Create a Docker image</h2><p>We did a bit of work in the previous steps and it’d be nice to avoid having to repeat it. Luckily, Docker provides <a href=\"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/\">Dockerfiles</a>, which can be used to build new Docker images from existing Docker images. Our goal here is to make a new Docker image that automatically starts the Valheim server without having to enter the container and manually enter commands as we did before. The Valheim server also needs to be shutdown gracefully so that current world data is properly saved whenever the container is stopped or restarted.  </p>\n<p>The Valheim server Docker image should be as generic as possible while allowing a user to customize server specific behavior at runtime (e.g. which world to use, what the password is, etc.). The strategy to do this is to separate the environment and installation setup from the actual command to start the server. This means we will write a custom script to start the Valheim server that controls how the server is started and shutdown. The Valheim server also needs to persist the worlds data into the host machine (as the containers are meant to be ephemeral). Persistence is accomplished by <a href=\"https://docs.docker.com/storage/bind-mounts/\">binding a directory from the host machine to a Docker volume</a> (this is also how we can add existing worlds to the server).  </p>\n<p>Given all that, here is our Dockerfile to build the Valheim server image:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> cm2network/steamcmd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># where the Valheim server is installed to</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_SERVER_DIR <span class=\"string\">&quot;/home/steam/valheim-server&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># install the Valheim server</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> ./steamcmd.sh +login anonymous \\</span></span><br><span class=\"line\"><span class=\"bash\">+force_install_dir <span class=\"variable\">$VALHEIM_SERVER_DIR</span> \\</span></span><br><span class=\"line\"><span class=\"bash\">+app_update 896660 \\</span></span><br><span class=\"line\"><span class=\"bash\">validate +<span class=\"built_in\">exit</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># where world data is stored, map this to the host directory where your worlds are stored</span></span><br><span class=\"line\"><span class=\"comment\"># e.g. docker run -v /path/to/host/directory:/home/steam/valheim-data</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_DATA_DIR <span class=\"string\">&quot;/home/steam/valheim-data&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># don&#x27;t change the port unless you know what you are doing</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_PORT <span class=\"number\">2456</span></span><br><span class=\"line\"><span class=\"comment\"># server and world name are truncated after 1st white space</span></span><br><span class=\"line\"><span class=\"comment\"># you must set values to the server and world name otherwise the container will exit immediately</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_SERVER_NAME=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_WORLD_NAME=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> VALHEIM_PASSWORD <span class=\"string\">&quot;password&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># the server needs these 3 ports exposed by default</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">2456</span>/udp</span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">2457</span>/udp</span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">2458</span>/udp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"bash\"> <span class=\"variable\">$&#123;VALHEIM_DATA_DIR&#125;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># copy over the modified server start script</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> start-valheim-server.sh <span class=\"variable\">$&#123;VALHEIM_SERVER_DIR&#125;</span></span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> <span class=\"variable\">$&#123;VALHEIM_SERVER_DIR&#125;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># start the server!</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"bash\"> [<span class=\"string\">&quot;./start-valheim-server.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>\n<p>I added comments to explain each part of this new Dockerfile for building a Valheim server image. Of note is that behavior is customized by passing in different values for the environment variables, e.g. one could change the world name by passing in <code>--env VALHEIM_WORLD_NAME=&quot;AWholeNewWorld&quot;</code> when executing <code>docker run</code>.  </p>\n<p>What does our <code>start-valheim-server.sh</code> look like?  Below is what I’ve come up with:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker sends a SIGTERM and then SIGKILL to the main process</span></span><br><span class=\"line\"><span class=\"comment\"># Valheim needs a SIGINT (CTRL+C) to terminate properly</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> shutdownValheimGracefully()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim server PID is: <span class=\"variable\">$1</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># send a SIGINT to shut down the Valheim server gracefully</span></span><br><span class=\"line\">    <span class=\"built_in\">kill</span> -2 <span class=\"variable\">$1</span></span><br><span class=\"line\">    <span class=\"comment\"># wait for Valheim to terminate before shutting down the container</span></span><br><span class=\"line\">    <span class=\"built_in\">wait</span> <span class=\"variable\">$1</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># catch Docker&#x27;s SIGTERM, then then a SIGINT to the Valheim server process</span></span><br><span class=\"line\"><span class=\"built_in\">trap</span> <span class=\"string\">&#x27;shutdownValheimGracefully &quot;$VALHEIM_PID&quot;&#x27;</span> SIGTERM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> templdpath=<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LD_LIBRARY_PATH=./linux64:<span class=\"variable\">$LD_LIBRARY_PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SteamAppId=892970</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Starting server PRESS CTRL-C to exit&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;LD_LIBRARY_PATH: <span class=\"variable\">$LD_LIBRARY_PATH</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim port is: <span class=\"variable\">$VALHEIM_PORT</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim server name is: <span class=\"variable\">$VALHEIM_SERVER_NAME</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim world name is: <span class=\"variable\">$VALHEIM_WORLD_NAME</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$VALHEIM_SERVER_DIR</span></span><br><span class=\"line\"><span class=\"comment\"># start the server as a background process to get its PID (&quot;&amp;&quot; at end of command)</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;&amp;&gt;&gt;&quot; means append all stdout and stderr to the log file</span></span><br><span class=\"line\">./valheim_server.x86_64 -name <span class=\"variable\">$VALHEIM_SERVER_NAME</span> \\</span><br><span class=\"line\">-port <span class=\"variable\">$VALHEIM_PORT</span> \\</span><br><span class=\"line\">-world <span class=\"variable\">$VALHEIM_WORLD_NAME</span> \\</span><br><span class=\"line\">-password <span class=\"variable\">$VALHEIM_PASSWORD</span> \\</span><br><span class=\"line\">-savedir <span class=\"variable\">$VALHEIM_DATA_DIR</span> &amp;&gt;&gt; /home/steam/valheim-data/valheim-logs.txt &amp;</span><br><span class=\"line\">VALHEIM_PID=$!</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Valheim server PID is: <span class=\"variable\">$VALHEIM_PID</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># since the server is run in the background, this is needed to keep the main process from exiting</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">wait</span> $!; [ $? != 0 ]; <span class=\"keyword\">do</span> <span class=\"literal\">true</span>; <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<p>This script is mostly a copy of the original <code>start_server.sh</code> script that comes with Valheim server installation.  I’ve added comments to explain some of the changes made to accommodate running the server in Docker. Most importantly is providing a graceful shutdown to the running Valheim server, which needs a <code>SIGINT</code> signal to properly terminate (equivalent to hitting CTRL+C when running the server manually). Docker sends a <code>SIGTERM</code> signal by default. This script traps the <code>SIGTERM</code> signal, and then sends a <code>SIGINT</code> signal to the Valheim server process (the <code>kill -2</code> command) before exiting properly.  Without this behavior, the server would not terminate properly and thus world data would not be saved completely. For more background on why this is necessary, see this wonderful article: <a href=\"https://www.ctl.io/developers/blog/post/gracefully-stopping-docker-containers/\">Gracefully Stopping Docker Containers</a>.  </p>\n<p>To build our image, create a new directory on the host machine and create two files in it called <code>Dockerfile</code> and <code>start-valheim-server.sh</code>. <code>Dockerfile</code> should be exactly the contents of the Dockerfile I provided above, and likewise for the custom start script. Note the file to build the Docker image <strong>must</strong> be named <code>Dockerfile</code>. On the host terminal, enter the directory and build the new image using <a href=\"https://docs.docker.com/engine/reference/commandline/build/\">docker build</a>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine docker % <span class=\"built_in\">pwd</span></span><br><span class=\"line\">/home/sethmachine/valheim/docker</span><br><span class=\"line\">sethmachine docker % ls</span><br><span class=\"line\">Dockerfile              start-valheim-server.sh</span><br><span class=\"line\">sethmachine docker % docker build -t sethmachine/valheim-server .</span><br><span class=\"line\">[+] Building 0.2s (10/10) FINISHED                                                                                                                                          </span><br><span class=\"line\"> =&gt; [internal] load build definition from Dockerfile                                                                                                                   0.0s</span><br><span class=\"line\"> =&gt; =&gt; transferring dockerfile: 1.15kB                                                                                                                                 0.0s</span><br><span class=\"line\"> =&gt; [internal] load .dockerignore                                                                                                                                      0.0s</span><br><span class=\"line\"> =&gt; =&gt; transferring context: 2B                                                                                                                                        0.0s</span><br><span class=\"line\"> =&gt; [internal] load metadata <span class=\"keyword\">for</span> docker.io/cm2network/steamcmd:latest                                                                                                  0.0s</span><br><span class=\"line\"> =&gt; [1/5] FROM docker.io/cm2network/steamcmd                                                                                                                           0.0s</span><br><span class=\"line\"> =&gt; [internal] load build context                                                                                                                                      0.0s</span><br><span class=\"line\"> =&gt; =&gt; transferring context: 1.03kB                                                                                                                                    0.0s</span><br><span class=\"line\"> =&gt; CACHED [2/5] RUN ./steamcmd.sh +login anonymous +force_install_dir /home/steam/valheim-server +app_update 896660 validate +<span class=\"built_in\">exit</span>                                    0.0s</span><br><span class=\"line\"> =&gt; CACHED [3/5] RUN apt-get update &amp;&amp; apt-get install -y procps                                                                                                       0.0s</span><br><span class=\"line\"> =&gt; [4/5] COPY start-valheim-server.sh /home/steam/valheim-server                                                                                                      0.0s</span><br><span class=\"line\"> =&gt; [5/5] WORKDIR /home/steam/valheim-server                                                                                                                           0.0s</span><br><span class=\"line\"> =&gt; exporting to image                                                                                                                                                 0.0s</span><br><span class=\"line\"> =&gt; =&gt; exporting layers                                                                                                                                                0.0s</span><br><span class=\"line\"> =&gt; =&gt; writing image sha256:da020f90db05f93dfbcd9f0a2489cb5bcaa6baf9ac2bf9a84a37511c47384972                                                                           0.0s</span><br><span class=\"line\"> =&gt; =&gt; naming to docker.io/sethmachine/valheim-server                                                                                                                   0.0s </span><br></pre></td></tr></table></figure>\n<p><em>Note that rebuilding the image will re-use previous layers, including the version of the Valheim server downloaded.  This is both good and bad.  Good because it makes re-building the image very quick.  But it is bad if Valheim has updated the server and Docker’s cache has gone stale.  In that case, add the <code>--no-cache</code> argument when rebuilding if Valheim has been updated.</em></p>\n<p>The new image should now show up when running <code>docker image ls</code>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine % docker image ls | grep <span class=\"string\">&quot;valheim&quot;</span></span><br><span class=\"line\">sethmachine/valheim-server   latest    da020f90db05   5 minutes ago       1.71GB</span><br></pre></td></tr></table></figure>\n<p>Congrats, we have built a Valheim server Docker image!  Now we need to run it as a container.    </p>\n<h2 id=\"Run-the-valheim-server-image\"><a href=\"#Run-the-valheim-server-image\" class=\"headerlink\" title=\"Run the valheim-server image\"></a>Run the valheim-server image</h2><p>To run the Valheim server image, we need to decide where Valheim’s worlds data will be stored on the host machine, and then pass in parameters to decide the name, password, and world of the server.  </p>\n<p>The image volume <code>/home/steam/valheim-data</code> needs to be bound to a directory on the host machine where all worlds data is persisted. The host machine directory should be empty or contain a subdirectory called <code>worlds</code> which can contain already created Valheim worlds. When the Valheim server runs, if the world does not exist in the host directory, then it will be created anew. If the world already does exist (i.e. there are files in the <code>worlds</code> subdirectory with the name of the world), then the server will use it as the server’s world rather than making a new one. </p>\n<p>On my host machine, I have a directory at <code>/home/sethmachine/valeim-data</code> which I will map onto the image’s volume.  Here is what it looks like before I run the Valhem server and make a new world:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % tree /home/sethmachine/valeim-data</span><br><span class=\"line\">/home/sethmachine/valeim-data</span><br><span class=\"line\">└── worlds</span><br><span class=\"line\">    ├── OldWorld.db</span><br><span class=\"line\">    └── OldWorld.fwl</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 2 files</span><br></pre></td></tr></table></figure>\n<p>(<a href=\"https://en.wikipedia.org/wiki/Tree_(command)\">tree</a> is a helpful command to visualize a directory)</p>\n<p>This folder already has an existing world that I copied over, <code>OldWorld</code>, but your folder can be completely empty.  </p>\n<p>There are 3 parameters to set when running the server.  The server name and world name <strong>must</strong> be provided at runtime, otherwise the container will exit immediately.  </p>\n<ul>\n<li><code>VALHEIM_SERVER_NAME</code>: the name that will appear in Valheim’s server list, truncated at first whitespace</li>\n<li><code>VALHEIM_WORLD_NAME</code>: the name of the Valheim world (can be an existing world), truncated at first whitespace</li>\n<li><code>VALHEIM_PASSWORD</code>: the password to join the server (can be set to empty for no password, default is “password”)</li>\n</ul>\n<p>Below is an example command that runs a Valheim server with the host directory set to <code>/home/sethmachine/valeim-data</code>.  Note this container is named <code>valheim</code> to make it easier to reference with Docker commands.  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --name=valheim -d \\</span><br><span class=\"line\">-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\</span><br><span class=\"line\">-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\</span><br><span class=\"line\">--env VALHEIM_SERVER_NAME=<span class=\"string\">&quot;sethmachine&#x27;sServer&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_WORLD_NAME=<span class=\"string\">&quot;AWholeNewWorld&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_PASSWORD=<span class=\"string\">&quot;HardToGuessPassword&quot;</span> \\</span><br><span class=\"line\">sethmachine/valheim-server</span><br></pre></td></tr></table></figure>\n<p>Explanation:</p>\n<ul>\n<li><code>docker run</code>: creates a running container from an image, in this case the image is <code>sethmachine/valheim-server</code></li>\n<li><code>-d</code>: runs the container in the background</li>\n<li><code>-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp</code>: exposes and maps ports 2456, 2457, 2458 on the host to the container </li>\n<li><code>--env VALHEIM_SERVER_NAME=&quot;sethmachine&#39;sServer&quot;</code>: sets the server’s name</li>\n<li><code>--env VALHEIM_WORLD_NAME=&quot;AWholeNewWorld&quot;</code>: sets the world’s name</li>\n<li><code>--env VALHEIM_PASSWORD=&quot;HardToGuessPassword&quot;</code>: sets the server’s password</li>\n</ul>\n<p>Use <code>docker container ls</code> to confirm the server is running:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % docker container ls</span><br><span class=\"line\">CONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS           NAMES</span><br><span class=\"line\">db70c7b20af7   sethmachine/valheim-server   <span class=\"string\">&quot;./start-valheim-ser…&quot;</span>   10 minutes ago   Up 10 minutes   2456-2458/udp   valheim</span><br></pre></td></tr></table></figure>\n<p>Use <code>docker logs valheim</code> to get output information about the server:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % docker logs valheim</span><br><span class=\"line\">Starting server PRESS CTRL-C to <span class=\"built_in\">exit</span></span><br><span class=\"line\">LD_LIBRARY_PATH: ./linux64:</span><br><span class=\"line\">Valheim port is: 2456</span><br><span class=\"line\">Valheim server name is: sethmachine<span class=\"string\">&#x27;sServer</span></span><br><span class=\"line\"><span class=\"string\">Valheim world name is: AWholeNewWorld</span></span><br><span class=\"line\"><span class=\"string\">Valheim server PID is: 7</span></span><br></pre></td></tr></table></figure>\n<p>Under the mounted host directory (mine is <code>/home/sethmachine/valeim-data</code>), there should be several files and a “worlds” subdirectory:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % tree /home/sethmachine/valeim-data</span><br><span class=\"line\">/home/sethmachine/valeim-data</span><br><span class=\"line\">├── AWholeNewWorld-logs.txt</span><br><span class=\"line\">├── adminlist.txt</span><br><span class=\"line\">├── bannedlist.txt</span><br><span class=\"line\">├── permittedlist.txt</span><br><span class=\"line\">└── worlds</span><br><span class=\"line\">    ├── AWholeNewWorld.fwl</span><br><span class=\"line\">    ├── OldWorld.db</span><br><span class=\"line\">    └── OldWorld.fwl</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 7 files</span><br></pre></td></tr></table></figure>\n<p>What each of these files mean:</p>\n<ul>\n<li><code>AWholeNewWorld-logs.txt</code>: this is a Valheim specific log file for the world we created</li>\n<li><code>adminlist.txt</code>: determines who is an admin (add Steam ID, one per line)</li>\n<li><code>bannedlist.txt</code>: automatically bans players (add Steam ID, one per line)</li>\n<li><code>permittedlist.txt</code>: whitelist for who can join (add Steam ID, one per line).  Note if this has a single Steam ID in it, this will ban everyone else from the server besides players whose Steam ID is in this list.</li>\n<li><code>worlds</code>: directory where Valheim worlds data is stored (including old or already existing worlds)</li>\n</ul>\n<p>If you’ve seen similar output on your end, then congrats, you are able to run the Valheim server Docker image!</p>\n<p>To stop the server, use <code>docker stop valheim</code>.  This will create a new database (<code>.db</code>) file for the world as well:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sethmachine valheim-server-docker % docker stop valheim</span><br><span class=\"line\">valheim</span><br><span class=\"line\">sethmachine valheim-server-docker % tree /home/sethmachine/valeim-data</span><br><span class=\"line\">/home/sethmachine/valeim-data</span><br><span class=\"line\">├── AWholeNewWorld-logs.txt</span><br><span class=\"line\">├── adminlist.txt</span><br><span class=\"line\">├── bannedlist.txt</span><br><span class=\"line\">├── permittedlist.txt</span><br><span class=\"line\">└── worlds</span><br><span class=\"line\">    ├── AWholeNewWorld.db</span><br><span class=\"line\">    ├── AWholeNewWorld.fwl</span><br><span class=\"line\">    ├── OldWorld.db</span><br><span class=\"line\">    └── OldWorld.fwl</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 8 files</span><br></pre></td></tr></table></figure>\n<p>Note the new <code>AWholeNewWorld.db</code> file.  This contains the save data of the world; because it has been created, we know the Valheim server shut down properly.   </p>\n<p>For the server to be up almost 24/7 we will want it to restart automatically whenever it is turned off (e.g. the host machine restarts or the Docker container somehow crashes, is killed, etc.).  To do this, we specify a <a href=\"https://docs.docker.com/config/containers/start-containers-automatically/\">restart policy</a> when running the container.  The <code>always</code> policy appears appropriate, as it means the server will automatically run whenever Docker restarts.  Only manually stopping the server with <code>docker stop</code> will prevent it from automatically restarting.  Finally, this gives us a suitable command to begin running our server indefinitely!</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --name=valheim -d \\</span><br><span class=\"line\">--restart always \\</span><br><span class=\"line\">-p 2456:2456/udp -p 2457:2457/udp -p 2458:2458/udp \\</span><br><span class=\"line\">-v /home/sethmachine/valeim-data:/home/steam/valheim-data \\</span><br><span class=\"line\">--env VALHEIM_SERVER_NAME=<span class=\"string\">&quot;sethmachine&#x27;sServer&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_WORLD_NAME=<span class=\"string\">&quot;AWholeNewWorld&quot;</span> \\</span><br><span class=\"line\">--env VALHEIM_PASSWORD=<span class=\"string\">&quot;HardToGuessPassword&quot;</span> \\</span><br><span class=\"line\">sethmachine/valheim-server</span><br></pre></td></tr></table></figure>\n<p>With <code>--restart always</code> and Docker Desktop set to restart on log in, our server should be up and running all the time once we execute the above command.  Note you can still use <code>docker stop valheim</code> followed by <code>docker rm valheim</code> to stop the server completely (e.g. you want to run a different world or take a break).</p>\n<h2 id=\"Port-Forwarding\"><a href=\"#Port-Forwarding\" class=\"headerlink\" title=\"Port Forwarding\"></a>Port Forwarding</h2><p><em>This step is highly dependent upon your internet service provider and firewall settings of the host machine.  You will likely need to do additional research to open the ports on your host machine</em></p>\n<p>Hosting a dedicated server requires allowing incoming connections from the ports the Valheim server uses.  These ports are 2456, 2457, and 2458 (UDP protocol).  Without these ports open, your server will not be visible and your friends cannot play with you.  </p>\n<p>In general you will need to follow these steps:</p>\n<ul>\n<li>Disable any firewall software on your host machine.  If you know how to modify your firewall just for the Valheim ports, feel free to do so instead.  </li>\n<li>Find your router’s IP address and then log in to it, e.g. see <a href=\"https://www.highspeedinternet.com/resources/how-to-log-in-to-your-router\">How to Log In to Your Router</a>  </li>\n<li>In the router admin controls, find where to add port forwarding rules.</li>\n</ul>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/router-port-forwarding-location.png\"></p>\n<ul>\n<li>Find the LAN IP address of the host machine, e.g. see: <a href=\"https://uca.edu/it/knowledgebase-legacy/finding-your-ip-address-lan/\">Find your LAN IP address</a>.  The LAN IP is the IP assigned to the host machine within your local/home network.  </li>\n<li>Create 3 new port forwarding rules for the host machine’s LAN IP that allow any traffic to 2456, 2457, and 2458, all for UDP. </li>\n</ul>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/show-forwarded-ports-2456-2457-2458.png\"></p>\n<p>We can use external tools and websites to see if the ports were opened correctly.  </p>\n<ul>\n<li>Turn on the Valheim server if it is not already running.     </li>\n<li>First, find your public IP address.  Head to <a href=\"https://www.whatismyip.com/\">whatsmyip.com</a> and keep a note of the IP v4 address.  Note most home ISPs use dynamic IPs, so at some point your IP will change and you will have to update any configurations based on the your public IP.  </li>\n<li>Head to <a href=\"https://check-host.net/\">check-host.net</a> and put in your public IP address followed by a colon and then the port number.  We will test each port (2456, 2457, 2458) individually.  Then hit the “UDP port” button.  If your ports are open you should see similar results to mine below.  If you see “Open or Filtered” it means it’s working.  If you see “Connection Refused”, re-check your port forwarding settings and make sure the Valheim server is running.  </li>\n</ul>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/show-check-host-ports-open.png\"></p>\n<h2 id=\"Access-your-server-on-Steam\"><a href=\"#Access-your-server-on-Steam\" class=\"headerlink\" title=\"Access your server on Steam\"></a>Access your server on Steam</h2><p>With the server running and the proper ports exposed, we can finally use the server on Steam!  </p>\n<p>Head to your Steam client and access servers from the view menu:</p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/steam-view-servers-menu.png\"></p>\n<p>This will open a new window to manage servers.  Select the “Favorites” tab and then “Add a server”.  Enter your IPv4 address followed by port <code>2457</code>, then add the server:</p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/steam-add-server.png\"></p>\n<p>If it works, you’ll see your server listed like mine:</p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/steam-server-listed.png\"></p>\n<p>If you do not see anything, trying hitting the refresh button.  If your server is listed as offline or unable to connect, re-visit the previous steps. Make sure your server is actually running.  Make sure ports 2456, 2457, and 2458 are exposed.  </p>\n<p>Finally, we can actually join the server in Valheim!  </p>\n<p><img src=\"/2021/02/10/host-valheim-with-docker/valeheim-see-server.png\"></p>\n<h2 id=\"Final-thoughts\"><a href=\"#Final-thoughts\" class=\"headerlink\" title=\"Final thoughts\"></a>Final thoughts</h2><p>We were able to successfully run the Valheim server on a Docker container, and allow it to be accessible so others can join!  We created a custom start script so the server would shut down properly and save world data.</p>\n<p>I’ve made a Docker image available on Docker Hub and the corresponding Dockerfile and script on GitHub:</p>\n<ul>\n<li>Docker Hub: <a href=\"https://hub.docker.com/r/sethmachineio/valheim-server\">sethmachineio/valheim-server</a></li>\n<li>GitHub: <a href=\"https://github.com/sethmachine/valheim-server-docker\">valheim-server-docker</a></li>\n</ul>\n<p>Feel free to leave a comment if you found this helpful, have any feedback, or are stuck on any parts of this guide.  I’ll do my best to respond and help you!  </p>\n<h3 id=\"Follow-up-tasks\"><a href=\"#Follow-up-tasks\" class=\"headerlink\" title=\"Follow up tasks\"></a>Follow up tasks</h3><p>There a few improvements we can make to make the Valheim server easier to use.  I will address these in a separate follow-up guide.  </p>\n<ul>\n<li>Automatically updating the server software without rebuilding the Docker image.  When Valheim provides updates to its game client, players on the newer client cannot join servers running on older versions of Valheim.  Right now to fix this requires stopping the server and building a new image using the <code>--no-cache</code> option.  As a follow-up we should modify the running container to automatically update itself whenever Valheim is updated.  </li>\n<li>Create backups of worlds periodically.  If anything should happen to the worlds save file (corrupted, accidentally deleted, someone griefs the server), it would be nice to have backups to revert to.  </li>\n</ul>\n"}],"PostAsset":[{"_id":"source/_posts/host-valheim-with-docker/change-docker-memory-cpus.png","slug":"change-docker-memory-cpus.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/docker-restart-on-log-in.png","slug":"docker-restart-on-log-in.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/router-port-forwarding-location.png","slug":"router-port-forwarding-location.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/show-check-host-ports-open.png","slug":"show-check-host-ports-open.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/show-forwarded-ports-2456-2457-2458.png","slug":"show-forwarded-ports-2456-2457-2458.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/steam-add-server.png","slug":"steam-add-server.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/steam-server-listed.png","slug":"steam-server-listed.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/steam-view-servers-menu.png","slug":"steam-view-servers-menu.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/valeheim-see-server.png","slug":"valeheim-see-server.png","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0},{"_id":"source/_posts/host-valheim-with-docker/valheim-dedicated-server-logo.jpg","slug":"valheim-dedicated-server-logo.jpg","post":"cklzrqf4p0003dunhbtp1hwm9","modified":0,"renderable":0}],"PostCategory":[],"PostTag":[{"post_id":"cklzrqf4p0003dunhbtp1hwm9","tag_id":"cklzrqf4s0004dunh9j2j5jq8","_id":"cklzrqf4v0009dunh3gnpffzw"},{"post_id":"cklzrqf4p0003dunhbtp1hwm9","tag_id":"cklzrqf4t0005dunh5hva8nkc","_id":"cklzrqf4v000adunh5vj41fh7"},{"post_id":"cklzrqf4p0003dunhbtp1hwm9","tag_id":"cklzrqf4u0006dunhcyi64l5j","_id":"cklzrqf4v000bdunhghcl5poe"},{"post_id":"cklzrqf4p0003dunhbtp1hwm9","tag_id":"cklzrqf4u0007dunhakkp4h4f","_id":"cklzrqf4v000cdunhdfmzfkh1"},{"post_id":"cklzrqf4p0003dunhbtp1hwm9","tag_id":"cklzrqf4u0008dunhh4zkf20d","_id":"cklzrqf4v000ddunhdgc46xqy"}],"Tag":[{"name":"Docker","_id":"cklzrqf4s0004dunh9j2j5jq8"},{"name":"Valheim","_id":"cklzrqf4t0005dunh5hva8nkc"},{"name":"Steam","_id":"cklzrqf4u0006dunhcyi64l5j"},{"name":"Port Forwarding","_id":"cklzrqf4u0007dunhakkp4h4f"},{"name":"Dedicated Server","_id":"cklzrqf4u0008dunhh4zkf20d"}]}}